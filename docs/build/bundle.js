var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function r(t){t.forEach(e)}function o(t){return"function"==typeof t}function i(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}let c,u;function l(t,e){return c||(c=document.createElement("a")),c.href=e,t===c.href}function s(e,...n){if(null==e)return t;const r=e.subscribe(...n);return r.unsubscribe?()=>r.unsubscribe():r}function a(t){let e;return s(t,(t=>e=t))(),e}function f(t,e){t.appendChild(e)}function d(t,e,n){t.insertBefore(e,n||null)}function h(t){t.parentNode.removeChild(t)}function p(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function g(t){return document.createElement(t)}function m(t){return document.createTextNode(t)}function y(){return m(" ")}function $(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function w(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function b(t){return""===t?null:+t}function v(t,e){t.value=null==e?"":e}function k(t,e){for(let n=0;n<t.options.length;n+=1){const r=t.options[n];if(r.__value===e)return void(r.selected=!0)}t.selectedIndex=-1}function x(t,e,n){t.classList[n?"add":"remove"](e)}function _(t){u=t}function C(t){(function(){if(!u)throw new Error("Function called outside component initialization");return u})().$$.on_mount.push(t)}function E(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach((t=>t.call(this,e)))}const A=[],M=[],S=[],q=[],L=Promise.resolve();let R=!1;function j(t){S.push(t)}const z=new Set;let K=0;function P(){const t=u;do{for(;K<A.length;){const t=A[K];K++,_(t),F(t.$$)}for(_(null),A.length=0,K=0;M.length;)M.pop()();for(let t=0;t<S.length;t+=1){const e=S[t];z.has(e)||(z.add(e),e())}S.length=0}while(A.length);for(;q.length;)q.pop()();R=!1,z.clear(),_(t)}function F(t){if(null!==t.fragment){t.update(),r(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(j)}}const D=new Set;let I;function O(t,e){t&&t.i&&(D.delete(t),t.i(e))}function B(t,e,n,r){if(t&&t.o){if(D.has(t))return;D.add(t),I.c.push((()=>{D.delete(t),r&&(n&&t.d(1),r())})),t.o(e)}}function N(t){t&&t.c()}function U(t,n,i,c){const{fragment:u,on_mount:l,on_destroy:s,after_update:a}=t.$$;u&&u.m(n,i),c||j((()=>{const n=l.map(e).filter(o);s?s.push(...n):r(n),t.$$.on_mount=[]})),a.forEach(j)}function G(t,e){const n=t.$$;null!==n.fragment&&(r(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function Q(t,e){-1===t.$$.dirty[0]&&(A.push(t),R||(R=!0,L.then(P)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function T(e,o,i,c,l,s,a,f=[-1]){const d=u;_(e);const p=e.$$={fragment:null,ctx:null,props:s,update:t,not_equal:l,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(o.context||(d?d.$$.context:[])),callbacks:n(),dirty:f,skip_bound:!1,root:o.target||d.$$.root};a&&a(p.root);let g=!1;if(p.ctx=i?i(e,o.props||{},((t,n,...r)=>{const o=r.length?r[0]:n;return p.ctx&&l(p.ctx[t],p.ctx[t]=o)&&(!p.skip_bound&&p.bound[t]&&p.bound[t](o),g&&Q(e,t)),n})):[],p.update(),g=!0,r(p.before_update),p.fragment=!!c&&c(p.ctx),o.target){if(o.hydrate){const t=function(t){return Array.from(t.childNodes)}(o.target);p.fragment&&p.fragment.l(t),t.forEach(h)}else p.fragment&&p.fragment.c();o.intro&&O(e.$$.fragment),U(e,o.target,o.anchor,o.customElement),P()}_(d)}class H{$destroy(){G(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const J=[];function V(t){return new Promise(((e,n)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>n(t.error)}))}function W(t,e){const n=indexedDB.open(t);n.onupgradeneeded=()=>n.result.createObjectStore(e);const r=V(n);return(t,n)=>r.then((r=>n(r.transaction(e,t).objectStore(e))))}let X;function Y(){return X||(X=W("keyval-store","keyval")),X}function Z(t,e=Y()){return e("readonly",(e=>V(e.get(t))))}function tt(t,e,n=Y()){return n("readwrite",(n=>(n.put(e,t),V(n.transaction))))}function et(t,e=Y()){return e("readwrite",(e=>(e.delete(t),V(e.transaction))))}function nt(t,e){return t.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},V(t.transaction)}var rt=Object.freeze({__proto__:null,clear:function(t=Y()){return t("readwrite",(t=>(t.clear(),V(t.transaction))))},createStore:W,del:et,delMany:function(t,e=Y()){return e("readwrite",(e=>(t.forEach((t=>e.delete(t))),V(e.transaction))))},entries:function(t=Y()){return t("readonly",(e=>{if(e.getAll&&e.getAllKeys)return Promise.all([V(e.getAllKeys()),V(e.getAll())]).then((([t,e])=>t.map(((t,n)=>[t,e[n]]))));const n=[];return t("readonly",(t=>nt(t,(t=>n.push([t.key,t.value]))).then((()=>n))))}))},get:Z,getMany:function(t,e=Y()){return e("readonly",(e=>Promise.all(t.map((t=>V(e.get(t)))))))},keys:function(t=Y()){return t("readonly",(t=>{if(t.getAllKeys)return V(t.getAllKeys());const e=[];return nt(t,(t=>e.push(t.key))).then((()=>e))}))},promisifyRequest:V,set:tt,setMany:function(t,e=Y()){return e("readwrite",(e=>(t.forEach((t=>e.put(t[1],t[0]))),V(e.transaction))))},update:function(t,e,n=Y()){return n("readwrite",(n=>new Promise(((r,o)=>{n.get(t).onsuccess=function(){try{n.put(e(this.result),t),r(V(n.transaction))}catch(t){o(t)}}}))))},values:function(t=Y()){return t("readonly",(t=>{if(t.getAll)return V(t.getAll());const e=[];return nt(t,(t=>e.push(t.value))).then((()=>e))}))}});const{get:ot,set:it}=rt,ct=(e,n)=>{const r=function(e,n=t){let r;const o=new Set;function c(t){if(i(e,t)&&(e=t,r)){const t=!J.length;for(const t of o)t[1](),J.push(t,e);if(t){for(let t=0;t<J.length;t+=2)J[t][0](J[t+1]);J.length=0}}}return{set:c,update:function(t){c(t(e))},subscribe:function(i,u=t){const l=[i,u];return o.add(l),1===o.size&&(r=n(c)||t),i(e),()=>{o.delete(l),0===o.size&&(r(),r=null)}}}}(n);return"undefined"==typeof indexedDB||((async()=>{const t=await ot(e);null!=t&&r.set(t)})(),r.subscribe((t=>{it(e,t)}))),r};function ut(t){return new Promise((e=>{const n=new FileReader;n.readAsDataURL(t),n.onload=async()=>{"string"==typeof n.result&&e(n.result)}}))}const lt=function(){const{subscribe:t,update:e,set:n}=ct("chosen-images",[]);return{subscribe:t,push:(...t)=>{e((e=>[...e,...t]))},delete:(...t)=>{e((e=>{var n;for(let r of t)(null===(n=e[r])||void 0===n?void 0:n.FullResKey)&&et(e[r].FullResKey),e[r]=null;return e.filter((t=>t))}))},get:()=>a(lt),getLink:async t=>{const e=a(lt)[t];if(e.FullResKey){const t=await Z(e.FullResKey);return await ut(t)}return e.url}}}();function st(e){let n,r,o,i,c;return{c(){n=g("img"),l(n.src,r=e[0].url)||w(n,"src",r),w(n,"alt",o=e[0].name),w(n,"class","svelte-9h94g7"),x(n,"selected",e[1])},m(t,r){d(t,n,r),i||(c=$(n,"click",e[2]),i=!0)},p(t,[e]){1&e&&!l(n.src,r=t[0].url)&&w(n,"src",r),1&e&&o!==(o=t[0].name)&&w(n,"alt",o),2&e&&x(n,"selected",t[1])},i:t,o:t,d(t){t&&h(n),i=!1,c()}}}function at(t,e,n){let{data:r}=e,{selected:o}=e;return t.$$set=t=>{"data"in t&&n(0,r=t.data),"selected"in t&&n(1,o=t.selected)},[r,o,function(e){E.call(this,t,e)}]}class ft extends H{constructor(t){super(),T(this,t,at,st,i,{data:0,selected:1})}}function dt(t,e,n){const r=t.slice();return r[6]=e[n],r[8]=n,r}function ht(t){let e,n;return e=new ft({props:{data:t[6],selected:t[0][t[8]]}}),e.$on("click",(function(){return t[5](t[8])})),{c(){N(e.$$.fragment)},m(t,r){U(e,t,r),n=!0},p(n,r){t=n;const o={};2&r&&(o.data=t[6]),1&r&&(o.selected=t[0][t[8]]),e.$set(o)},i(t){n||(O(e.$$.fragment,t),n=!0)},o(t){B(e.$$.fragment,t),n=!1},d(t){G(e,t)}}}function pt(t){let e,n,o,i,c,u,l,s,a,m,b,v,k=t[1],x=[];for(let e=0;e<k.length;e+=1)x[e]=ht(dt(t,k,e));const _=t=>B(x[t],1,1,(()=>{x[t]=null}));return{c(){e=g("div"),n=g("div"),o=g("button"),o.textContent="delete",i=y(),c=g("button"),c.textContent="unselect",u=y(),l=g("button"),l.textContent="invert selection",s=y(),a=g("div");for(let t=0;t<x.length;t+=1)x[t].c();w(n,"class","header"),w(a,"class","content svelte-115ye2s"),w(e,"class","gallery")},m(r,h){d(r,e,h),f(e,n),f(n,o),f(n,i),f(n,c),f(n,u),f(n,l),f(e,s),f(e,a);for(let t=0;t<x.length;t+=1)x[t].m(a,null);m=!0,b||(v=[$(o,"click",t[2]),$(c,"click",t[4]),$(l,"click",t[3])],b=!0)},p(t,[e]){if(3&e){let n;for(k=t[1],n=0;n<k.length;n+=1){const r=dt(t,k,n);x[n]?(x[n].p(r,e),O(x[n],1)):(x[n]=ht(r),x[n].c(),O(x[n],1),x[n].m(a,null))}for(I={r:0,c:[],p:I},n=k.length;n<x.length;n+=1)_(n);I.r||r(I.c),I=I.p}},i(t){if(!m){for(let t=0;t<k.length;t+=1)O(x[t]);m=!0}},o(t){x=x.filter(Boolean);for(let t=0;t<x.length;t+=1)B(x[t]);m=!1},d(t){t&&h(e),p(x,t),b=!1,r(v)}}}function gt(t,e,n){let r;var o,i;o=lt,i=t=>n(1,r=t),t.$$.on_destroy.push(s(o,i));let c={};return[c,r,function(){const t=Object.entries(c).filter((t=>t[1])).map((t=>Number(t[0])));lt.delete(...t),n(0,c={})},function(){n(0,c=Object.fromEntries(r.map(((t,e)=>[e,!c[e]]))))},()=>n(0,c={}),t=>n(0,c[t]=!c[t],c)]}class mt extends H{constructor(t){super(),T(this,t,gt,pt,i,{})}}function yt(e){let n,r,o;return{c(){n=g("input"),w(n,"type","file"),n.multiple=!0,w(n,"accept","image/*")},m(t,i){d(t,n,i),r||(o=$(n,"change",e[0]),r=!0)},p:t,i:t,o:t,d(t){t&&h(n),r=!1,o()}}}async function $t(t,e){const n=document.createElement("canvas"),r=n.getContext("2d"),o=await function(t){return new Promise((e=>{const n=new Image;n.src=t,n.onload=()=>e(n)}))}(t),i=o.width*o.height,c=Math.sqrt(e/i),u=Math.round(o.width*c),l=Math.round(o.height*c);return n.width=u,n.height=l,r.drawImage(o,0,0,u,l),n.toDataURL()}function wt(t){async function e(t){let e={name:t.name,url:null};const n=await ut(t);t.size>15e4?(console.log(t.size),e.url=await $t(n,9e4),e.FullResKey=function(t){const e=Date.now().toString();return tt(e,t),e}(t)):e.url=n,lt.push(e)}return[async t=>{const n=t.target,{files:r}=n;for(const t of r)e(t)}]}class bt extends H{constructor(t){super(),T(this,t,wt,yt,i,{})}}async function vt(t){try{console.log("fetch",t);const e=await fetch(t);403==e.status&&console.log("forbidden, don't forget to sign into reddit"),console.log(e);return(await e.json()).data}catch(t){console.log(t)}}function kt(t,e,n){const r=t.slice();return r[20]=e[n],r}function xt(t){let e,n,o,i,c,u,l,s,a=0==t[2]&&Ct(t);return{c(){a&&a.c(),e=m("\r\n            search: "),n=g("input"),o=g("br"),i=m("\r\n            subreddits: "),c=g("input"),u=g("br"),w(n,"type","text"),w(n,"placeholder",'keywords split by " ,;"'),w(c,"type","text"),w(c,"placeholder",'keywords split by " ,;"')},m(r,f){a&&a.m(r,f),d(r,e,f),d(r,n,f),v(n,t[1]),d(r,o,f),d(r,i,f),d(r,c,f),v(c,t[0]),d(r,u,f),l||(s=[$(n,"input",t[15]),$(c,"input",t[16])],l=!0)},p(t,r){0==t[2]?a?a.p(t,r):(a=Ct(t),a.c(),a.m(e.parentNode,e)):a&&(a.d(1),a=null),2&r&&n.value!==t[1]&&v(n,t[1]),1&r&&c.value!==t[0]&&v(c,t[0])},d(t){a&&a.d(t),t&&h(e),t&&h(n),t&&h(o),t&&h(i),t&&h(c),t&&h(u),l=!1,r(s)}}}function _t(t){let e,n,r,o,i;return{c(){e=m("url: "),n=g("input"),r=g("br"),w(n,"type","text")},m(c,u){d(c,e,u),d(c,n,u),v(n,t[3]),d(c,r,u),o||(i=$(n,"input",t[12]),o=!0)},p(t,e){8&e&&n.value!==t[3]&&v(n,t[3])},d(t){t&&h(e),t&&h(n),t&&h(r),o=!1,i()}}}function Ct(t){let e,n,o,i,c,u,l,s,a=t[7],f=[];for(let e=0;e<a.length;e+=1)f[e]=Et(kt(t,a,e));return{c(){e=m("username: u/"),n=g("input"),o=g("br"),i=m("\r\n                category: \r\n                "),c=g("select");for(let t=0;t<f.length;t+=1)f[t].c();u=g("br"),w(n,"type","text"),void 0===t[5]&&j((()=>t[14].call(c)))},m(r,a){d(r,e,a),d(r,n,a),v(n,t[4]),d(r,o,a),d(r,i,a),d(r,c,a);for(let t=0;t<f.length;t+=1)f[t].m(c,null);k(c,t[5]),d(r,u,a),l||(s=[$(n,"input",t[13]),$(c,"change",t[14])],l=!0)},p(t,e){if(16&e&&n.value!==t[4]&&v(n,t[4]),128&e){let n;for(a=t[7],n=0;n<a.length;n+=1){const r=kt(t,a,n);f[n]?f[n].p(r,e):(f[n]=Et(r),f[n].c(),f[n].m(c,null))}for(;n<f.length;n+=1)f[n].d(1);f.length=a.length}160&e&&k(c,t[5])},d(t){t&&h(e),t&&h(n),t&&h(o),t&&h(i),t&&h(c),p(f,t),t&&h(u),l=!1,r(s)}}}function Et(e){let n,r,o,i=e[20]+"";return{c(){n=g("option"),r=m(i),n.__value=o=e[20],n.value=n.__value},m(t,e){d(t,n,e),f(n,r)},p:t,d(t){t&&h(n)}}}function At(e){let n,o,i,c,u,l,s,a,p,k,x,_,C,E,A,M,S,q;function L(t,e){return 2==t[2]?_t:xt}let R=L(e),j=R(e);return{c(){n=g("div"),o=g("div"),i=g("button"),i.textContent="user",c=y(),u=g("button"),u.textContent="search",l=y(),s=g("button"),s.textContent="custom",a=y(),p=g("div"),j.c(),k=m("\r\n        count: "),x=g("input"),_=g("br"),C=m("\r\n        nsfw: "),E=g("input"),A=y(),M=g("button"),M.textContent="load",w(o,"class","head"),w(x,"type","number"),w(E,"type","checkbox"),w(p,"class","options"),w(n,"class","redditSearch")},m(t,r){d(t,n,r),f(n,o),f(o,i),f(o,c),f(o,u),f(o,l),f(o,s),f(n,a),f(n,p),j.m(p,null),f(p,k),f(p,x),v(x,e[6].count),f(p,_),f(p,C),f(p,E),E.checked=e[6].nsfw,f(n,A),f(n,M),S||(q=[$(i,"click",e[9]),$(u,"click",e[10]),$(s,"click",e[11]),$(x,"input",e[17]),$(E,"change",e[18]),$(M,"click",e[8])],S=!0)},p(t,[e]){R===(R=L(t))&&j?j.p(t,e):(j.d(1),j=R(t),j&&(j.c(),j.m(p,k))),64&e&&b(x.value)!==t[6].count&&v(x,t[6].count),64&e&&(E.checked=t[6].nsfw)},i:t,o:t,d(t){t&&h(n),j.d(),S=!1,r(q)}}}function Mt(t){return t.split(/[ ,;]/).filter((t=>t.trim().length>0))}function St(t,e,n){let r,o,i=0,c="",u="",l="",s="",a=["upvoted","posts"];return t.$$.update=()=>{3&t.$$.dirty&&n(6,o={subreddits:Mt(u),keywords:Mt(l),nsfw:!0,count:5})},[u,l,i,c,s,r,o,a,async function(){var t;let e=function(){let t="https://www.reddit.com";switch(i){case 0:t+=`/user/${s}/${r}`;break;case 1:t+=`/search/?q=${o.keywords.join(" ")}`;break;case 2:t=c}return t}(),u=e.split(/\/\?|\?/);e=`${u[0]}.json${u[1]?"?"+u[1]:""}`,1==i&&n(6,o.keywords=[],o);const l=await async function(t,e){let{subreddits:n,keywords:r,nsfw:o,count:i=10}=e;0==n.length&&(n=[""]),0==r.length&&(r=[""]);const c=(t+=t.includes("?")?"&":"?")+"include_over_18="+(o?"on":"off");n=n.map((t=>t.toLowerCase())),r=r.map((t=>t.toLowerCase()));const u=Math.min(i,100),l=[];let s=await vt(`${c}&limit=${u}`),a=s.children;const f=t=>{let e=t.data;return n.some((t=>e.subreddit.toLowerCase().includes(t)))||r.some((t=>e.title.toLowerCase().includes(t)))};for(let t=0;t<a.length;t++)f(a[t])&&l.push(a[t].data);let d=a.length;for(;(null==s?void 0:s.after)&&d<i;){s=await vt(t+"&after="+s.after),a=s.children;for(let t=0;t<a.length;t++)f(a[t])&&l.push(a[t].data);d+=a.length}return l}(e,o);for(let e of l)lt.push({url:null!==(t=null==e?void 0:e.url_overridden_by_dest)&&void 0!==t?t:null==e?void 0:e.url,name:null==e?void 0:e.title})},()=>n(2,i=0),()=>n(2,i=1),()=>n(2,i=2),function(){c=this.value,n(3,c)},function(){s=this.value,n(4,s)},function(){r=function(t){const e=t.querySelector(":checked")||t.options[0];return e&&e.__value}(this),n(5,r),n(7,a)},function(){l=this.value,n(1,l)},function(){u=this.value,n(0,u)},function(){o.count=b(this.value),n(6,o),n(0,u),n(1,l)},function(){o.nsfw=this.checked,n(6,o),n(0,u),n(1,l)}]}class qt extends H{constructor(t){super(),T(this,t,St,At,i,{})}}async function Lt(t){return new Promise(((e,n)=>{let r=new Image;r.src=t,r.onload=function(){e(r)},r.onerror=function(t,e){n()}}))}async function Rt(t,e){const[n,r]=await async function(t){const e=await Lt(t);return[e.width,e.height]}(e);return{ratio:n/r,items:[t]}}function jt(t,e,n,r,o,i,c=0){console.log(n,r,o,i);let[u,l]=function(t,e,n){const r=t/e;return r>n?t*=n/r:e*=r/n,[t,e]}(o,i,e.ratio);return zt(t,e,n,r,u+c,l+c,c),[u,l]}async function zt(t,e,n,r,o,i,c=0){if(null==e.horizontal||"number"==typeof e.items[0]){let u=e.items[0];if(u<0)return;return void async function(t,e,n,r,o,i){const c=await Lt(e),u=c.width/c.height,l=o/i;let s=u>l?l/u*c.width:c.width,a=u>l?c.height:u/l*c.height,f=(c.width-s)/2,d=(c.height-a)/2;t.drawImage(c,f,d,s,a,n,r,o,i)}(t,await lt.getLink(u),n,r,o-c,i-c)}let u=0;if(1==e.horizontal)for(let l of e.items){let s=l.ratio/e.ratio*o;await zt(t,l,n+u,r,s,i,c),u+=s}else for(let l of e.items){let s=e.ratio/l.ratio*i;await zt(t,l,n,r+u,o,s,c),u+=s}}function Kt(e){let n,o,i,c,u,l,s,a,p,k,x,_,C,E,A,M,S,q,L,R,j,z,K;return{c(){n=g("div"),o=g("div"),i=m("1280x720, 1920×1080, 2560×1440, 3200×1800, 3840×2160"),c=g("br"),u=m("\r\n        width: "),l=g("input"),s=m("\r\n        height: "),a=g("input"),p=m("\r\n        margin: "),k=g("input"),x=m("\r\n        border: "),_=g("input"),C=m("\r\n        background: "),E=g("input"),A=y(),M=g("button"),M.textContent="generate",S=y(),q=g("div"),L=g("canvas"),R=y(),j=g("button"),j.textContent="snapshot",w(l,"type","number"),w(a,"type","number"),w(k,"type","number"),w(_,"type","number"),w(E,"type","color"),w(o,"class","settings"),w(L,"height",e[2]),w(L,"width",e[1]),w(L,"class","svelte-1ryfd5b"),w(q,"class","display"),w(n,"class","collagesContainer svelte-1ryfd5b")},m(t,r){d(t,n,r),f(n,o),f(o,i),f(o,c),f(o,u),f(o,l),v(l,e[1]),f(o,s),f(o,a),v(a,e[2]),f(o,p),f(o,k),v(k,e[3]),f(o,x),f(o,_),v(_,e[4]),f(o,C),f(o,E),v(E,e[5]),f(o,A),f(o,M),f(n,S),f(n,q),f(q,L),e[13](L),f(n,R),f(n,j),z||(K=[$(l,"input",e[8]),$(a,"input",e[9]),$(k,"input",e[10]),$(_,"input",e[11]),$(E,"input",e[12]),$(M,"click",e[6]),$(j,"click",e[7])],z=!0)},p(t,[e]){2&e&&b(l.value)!==t[1]&&v(l,t[1]),4&e&&b(a.value)!==t[2]&&v(a,t[2]),8&e&&b(k.value)!==t[3]&&v(k,t[3]),16&e&&b(_.value)!==t[4]&&v(_,t[4]),32&e&&v(E,t[5]),4&e&&w(L,"height",t[2]),2&e&&w(L,"width",t[1])},i:t,o:t,d(t){t&&h(n),e[13](null),z=!1,r(K)}}}function Pt(t,e,n){let r,o;C((()=>{o=r.getContext("2d"),o.imageSmoothingEnabled=!0,o.imageSmoothingQuality="high"}));let i=1280,c=720,u=5,l=10,s="#F5DEB3",a=[i,c];return[r,i,c,u,l,s,async function(){n(0,r.width=i,r),n(0,r.height=c,r),o.fillStyle=s,o.clearRect(0,0,i,c),o.fillRect(0,0,i,c);const t=await async function(t){let e=lt.get();const n=[];for(let t=0;t<e.length;t++){let r=e[t];n.push(Rt(t,r.url))}let r=(await Promise.allSettled(n)).filter((t=>"fulfilled"==t.status)).map((t=>t.value));const o=r.length;r=[...r].sort(((t,e)=>t.ratio-e.ratio));let i=r.reduce(((t,e)=>t+e.ratio),0);const c=i/o;i=r.reduce(((t,e)=>t+Math.sqrt(c/e.ratio)*e.ratio),0);const u=i/Math.round(Math.sqrt(i/t));let l=[],s=0,a=0,f=0;for(let t=0;t<r.length;t++){const e=s/f;let n=u*Math.sqrt(e/c)-s;if(n<0){let e=a<-n;l.push(e?t-1:t),s=e?r[t-1].ratio:0,f=0}s+=r[t].ratio,f++,a=n}let d=0,h=[];l.push(r.length);for(let t of l){const e=r.slice(d,t),n=e.map((t=>t.ratio)).reduce(((t,e)=>t+e),0);h.push({ratio:n,horizontal:!0,items:[...e]}),d=t}const p={ratio:1/h.map((t=>t.ratio)).reduce(((t,e)=>t+1/e),0),horizontal:!1,items:[...h]};function g(t){return t.items.reduce(((t,e)=>t+e.items[0]),0)/t.items.length}p.items.sort(((t,e)=>g(t)-g(e)));for(let t of p.items)t.items.sort(((t,e)=>t.items[0]-e.items[0]));return p}(i/c),[e,f]=jt(o,t,l,l,i-2*l,c-2*l,u);a=[e+2*l,f+2*l]},async function(){const[t,e]=a,i=await createImageBitmap(r);n(0,r.width=t,r),n(0,r.height=e,r),o.drawImage(i,0,0);const c=r.toDataURL();let u=document.createElement("a");u.href=c,u.download="collage.png",u.click()},function(){i=b(this.value),n(1,i)},function(){c=b(this.value),n(2,c)},function(){u=b(this.value),n(3,u)},function(){l=b(this.value),n(4,l)},function(){s=this.value,n(5,s)},function(t){M[t?"unshift":"push"]((()=>{r=t,n(0,r)}))}]}class Ft extends H{constructor(t){super(),T(this,t,Pt,Kt,i,{})}}function Dt(e){let n,r,o,i,c,u,l,s,a,p,m,$,b,v,k;return i=new qt({}),u=new bt({}),p=new mt({}),v=new Ft({}),{c(){n=g("main"),r=g("h1"),r.textContent="1. Choose images",o=y(),N(i.$$.fragment),c=y(),N(u.$$.fragment),l=y(),s=g("h1"),s.textContent="2. Manage images",a=y(),N(p.$$.fragment),m=y(),$=g("h1"),$.textContent="3. Generate Collage",b=y(),N(v.$$.fragment),w(r,"class","svelte-enb3qt"),w(s,"class","svelte-enb3qt"),w($,"class","svelte-enb3qt"),w(n,"class","svelte-enb3qt")},m(t,e){d(t,n,e),f(n,r),f(n,o),U(i,n,null),f(n,c),U(u,n,null),f(n,l),f(n,s),f(n,a),U(p,n,null),f(n,m),f(n,$),f(n,b),U(v,n,null),k=!0},p:t,i(t){k||(O(i.$$.fragment,t),O(u.$$.fragment,t),O(p.$$.fragment,t),O(v.$$.fragment,t),k=!0)},o(t){B(i.$$.fragment,t),B(u.$$.fragment,t),B(p.$$.fragment,t),B(v.$$.fragment,t),k=!1},d(t){t&&h(n),G(i),G(u),G(p),G(v)}}}return new class extends H{constructor(t){super(),T(this,t,null,Dt,i,{})}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map

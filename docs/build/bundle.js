var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function o(t){t.forEach(e)}function r(t){return"function"==typeof t}function i(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}let c,l;function s(t,e){return c||(c=document.createElement("a")),c.href=e,t===c.href}function u(e,...n){if(null==e)return t;const o=e.subscribe(...n);return o.unsubscribe?()=>o.unsubscribe():o}function a(t){let e;return u(t,(t=>e=t))(),e}function f(t,e){t.appendChild(e)}function d(t,e,n){t.insertBefore(e,n||null)}function h(t){t.parentNode.removeChild(t)}function g(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function p(t){return document.createElement(t)}function m(t){return document.createTextNode(t)}function y(){return m(" ")}function w(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function $(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function b(t){return""===t?null:+t}function v(t,e){t.value=null==e?"":e}function x(t,e){for(let n=0;n<t.options.length;n+=1){const o=t.options[n];if(o.__value===e)return void(o.selected=!0)}t.selectedIndex=-1}function k(t,e,n){t.classList[n?"add":"remove"](e)}function _(t){l=t}function C(t){(function(){if(!l)throw new Error("Function called outside component initialization");return l})().$$.on_mount.push(t)}function E(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach((t=>t.call(this,e)))}const j=[],z=[],M=[],A=[],R=Promise.resolve();let S=!1;function q(t){M.push(t)}const L=new Set;let P=0;function K(){const t=l;do{for(;P<j.length;){const t=j[P];P++,_(t),F(t.$$)}for(_(null),j.length=0,P=0;z.length;)z.pop()();for(let t=0;t<M.length;t+=1){const e=M[t];L.has(e)||(L.add(e),e())}M.length=0}while(j.length);for(;A.length;)A.pop()();S=!1,L.clear(),_(t)}function F(t){if(null!==t.fragment){t.update(),o(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(q)}}const B=new Set;let I;function D(t,e){t&&t.i&&(B.delete(t),t.i(e))}function O(t,e,n,o){if(t&&t.o){if(B.has(t))return;B.add(t),I.c.push((()=>{B.delete(t),o&&(n&&t.d(1),o())})),t.o(e)}}function N(t){t&&t.c()}function U(t,n,i,c){const{fragment:l,on_mount:s,on_destroy:u,after_update:a}=t.$$;l&&l.m(n,i),c||q((()=>{const n=s.map(e).filter(r);u?u.push(...n):o(n),t.$$.on_mount=[]})),a.forEach(q)}function G(t,e){const n=t.$$;null!==n.fragment&&(o(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function Q(t,e){-1===t.$$.dirty[0]&&(j.push(t),S||(S=!0,R.then(K)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function T(e,r,i,c,s,u,a,f=[-1]){const d=l;_(e);const g=e.$$={fragment:null,ctx:null,props:u,update:t,not_equal:s,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(r.context||(d?d.$$.context:[])),callbacks:n(),dirty:f,skip_bound:!1,root:r.target||d.$$.root};a&&a(g.root);let p=!1;if(g.ctx=i?i(e,r.props||{},((t,n,...o)=>{const r=o.length?o[0]:n;return g.ctx&&s(g.ctx[t],g.ctx[t]=r)&&(!g.skip_bound&&g.bound[t]&&g.bound[t](r),p&&Q(e,t)),n})):[],g.update(),p=!0,o(g.before_update),g.fragment=!!c&&c(g.ctx),r.target){if(r.hydrate){const t=function(t){return Array.from(t.childNodes)}(r.target);g.fragment&&g.fragment.l(t),t.forEach(h)}else g.fragment&&g.fragment.c();r.intro&&D(e.$$.fragment),U(e,r.target,r.anchor,r.customElement),K()}_(d)}class H{$destroy(){G(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const J=[];function V(t){return new Promise(((e,n)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>n(t.error)}))}function W(t,e){const n=indexedDB.open(t);n.onupgradeneeded=()=>n.result.createObjectStore(e);const o=V(n);return(t,n)=>o.then((o=>n(o.transaction(e,t).objectStore(e))))}let X;function Y(){return X||(X=W("keyval-store","keyval")),X}function Z(t,e=Y()){return e("readonly",(e=>V(e.get(t))))}function tt(t,e,n=Y()){return n("readwrite",(n=>(n.put(e,t),V(n.transaction))))}function et(t,e=Y()){return e("readwrite",(e=>(e.delete(t),V(e.transaction))))}function nt(t,e){return t.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},V(t.transaction)}var ot=Object.freeze({__proto__:null,clear:function(t=Y()){return t("readwrite",(t=>(t.clear(),V(t.transaction))))},createStore:W,del:et,delMany:function(t,e=Y()){return e("readwrite",(e=>(t.forEach((t=>e.delete(t))),V(e.transaction))))},entries:function(t=Y()){return t("readonly",(e=>{if(e.getAll&&e.getAllKeys)return Promise.all([V(e.getAllKeys()),V(e.getAll())]).then((([t,e])=>t.map(((t,n)=>[t,e[n]]))));const n=[];return t("readonly",(t=>nt(t,(t=>n.push([t.key,t.value]))).then((()=>n))))}))},get:Z,getMany:function(t,e=Y()){return e("readonly",(e=>Promise.all(t.map((t=>V(e.get(t)))))))},keys:function(t=Y()){return t("readonly",(t=>{if(t.getAllKeys)return V(t.getAllKeys());const e=[];return nt(t,(t=>e.push(t.key))).then((()=>e))}))},promisifyRequest:V,set:tt,setMany:function(t,e=Y()){return e("readwrite",(e=>(t.forEach((t=>e.put(t[1],t[0]))),V(e.transaction))))},update:function(t,e,n=Y()){return n("readwrite",(n=>new Promise(((o,r)=>{n.get(t).onsuccess=function(){try{n.put(e(this.result),t),o(V(n.transaction))}catch(t){r(t)}}}))))},values:function(t=Y()){return t("readonly",(t=>{if(t.getAll)return V(t.getAll());const e=[];return nt(t,(t=>e.push(t.value))).then((()=>e))}))}});const{get:rt,set:it}=ot,ct=(e,n)=>{const o=function(e,n=t){let o;const r=new Set;function c(t){if(i(e,t)&&(e=t,o)){const t=!J.length;for(const t of r)t[1](),J.push(t,e);if(t){for(let t=0;t<J.length;t+=2)J[t][0](J[t+1]);J.length=0}}}return{set:c,update:function(t){c(t(e))},subscribe:function(i,l=t){const s=[i,l];return r.add(s),1===r.size&&(o=n(c)||t),i(e),()=>{r.delete(s),0===r.size&&(o(),o=null)}}}}(n);return"undefined"==typeof indexedDB||((async()=>{const t=await rt(e);null!=t&&o.set(t)})(),o.subscribe((t=>{it(e,t)}))),o};function lt(t){return new Promise((e=>{const n=new FileReader;n.readAsDataURL(t),n.onload=async()=>{"string"==typeof n.result&&e(n.result)}}))}const st=function(){const{subscribe:t,update:e,set:n}=ct("chosen-images",[]);return{subscribe:t,push:(...t)=>{e((e=>[...e,...t]))},delete:(...t)=>{e((e=>{var n;for(let o of t)(null===(n=e[o])||void 0===n?void 0:n.FullResKey)&&et(e[o].FullResKey),e[o]=null;return e.filter((t=>t))}))},get:()=>a(st),getLink:async t=>{const e=a(st)[t];if(e.FullResKey){const t=await Z(e.FullResKey);return await lt(t)}return e.url}}}();function ut(e){let n,o,r,i,c;return{c(){n=p("img"),s(n.src,o=e[0].url)||$(n,"src",o),$(n,"alt",r=e[0].name),$(n,"class","svelte-9h94g7"),k(n,"selected",e[1])},m(t,o){d(t,n,o),i||(c=w(n,"click",e[2]),i=!0)},p(t,[e]){1&e&&!s(n.src,o=t[0].url)&&$(n,"src",o),1&e&&r!==(r=t[0].name)&&$(n,"alt",r),2&e&&k(n,"selected",t[1])},i:t,o:t,d(t){t&&h(n),i=!1,c()}}}function at(t,e,n){let{data:o}=e,{selected:r}=e;return t.$$set=t=>{"data"in t&&n(0,o=t.data),"selected"in t&&n(1,r=t.selected)},[o,r,function(e){E.call(this,t,e)}]}class ft extends H{constructor(t){super(),T(this,t,at,ut,i,{data:0,selected:1})}}function dt(t,e,n){const o=t.slice();return o[6]=e[n],o[8]=n,o}function ht(t){let e,n;return e=new ft({props:{data:t[6],selected:t[0][t[8]]}}),e.$on("click",(function(){return t[5](t[8])})),{c(){N(e.$$.fragment)},m(t,o){U(e,t,o),n=!0},p(n,o){t=n;const r={};2&o&&(r.data=t[6]),1&o&&(r.selected=t[0][t[8]]),e.$set(r)},i(t){n||(D(e.$$.fragment,t),n=!0)},o(t){O(e.$$.fragment,t),n=!1},d(t){G(e,t)}}}function gt(t){let e,n,r,i,c,l,s,u,a,m,b,v,x=t[1],k=[];for(let e=0;e<x.length;e+=1)k[e]=ht(dt(t,x,e));const _=t=>O(k[t],1,1,(()=>{k[t]=null}));return{c(){e=p("div"),n=p("div"),r=p("button"),r.textContent="delete",i=y(),c=p("button"),c.textContent="unselect",l=y(),s=p("button"),s.textContent="invert selection",u=y(),a=p("div");for(let t=0;t<k.length;t+=1)k[t].c();$(n,"class","header"),$(a,"class","content svelte-115ye2s"),$(e,"class","gallery")},m(o,h){d(o,e,h),f(e,n),f(n,r),f(n,i),f(n,c),f(n,l),f(n,s),f(e,u),f(e,a);for(let t=0;t<k.length;t+=1)k[t].m(a,null);m=!0,b||(v=[w(r,"click",t[2]),w(c,"click",t[4]),w(s,"click",t[3])],b=!0)},p(t,[e]){if(3&e){let n;for(x=t[1],n=0;n<x.length;n+=1){const o=dt(t,x,n);k[n]?(k[n].p(o,e),D(k[n],1)):(k[n]=ht(o),k[n].c(),D(k[n],1),k[n].m(a,null))}for(I={r:0,c:[],p:I},n=x.length;n<k.length;n+=1)_(n);I.r||o(I.c),I=I.p}},i(t){if(!m){for(let t=0;t<x.length;t+=1)D(k[t]);m=!0}},o(t){k=k.filter(Boolean);for(let t=0;t<k.length;t+=1)O(k[t]);m=!1},d(t){t&&h(e),g(k,t),b=!1,o(v)}}}function pt(t,e,n){let o;var r,i;r=st,i=t=>n(1,o=t),t.$$.on_destroy.push(u(r,i));let c={};return[c,o,function(){const t=Object.entries(c).filter((t=>t[1])).map((t=>Number(t[0])));st.delete(...t),n(0,c={})},function(){n(0,c=Object.fromEntries(o.map(((t,e)=>[e,!c[e]]))))},()=>n(0,c={}),t=>n(0,c[t]=!c[t],c)]}class mt extends H{constructor(t){super(),T(this,t,pt,gt,i,{})}}function yt(e){let n,o,r;return{c(){n=p("input"),$(n,"type","file"),n.multiple=!0,$(n,"accept","image/*")},m(t,i){d(t,n,i),o||(r=w(n,"change",e[0]),o=!0)},p:t,i:t,o:t,d(t){t&&h(n),o=!1,r()}}}async function wt(t,e){const n=await bt(t),o=n.width*n.height,r=Math.sqrt(e/o);return(await $t(n,r)).toDataURL()}async function $t(t,e){const n=document.createElement("canvas"),o=n.getContext("2d"),r=Math.round(t.width*e),i=Math.round(t.height*e);return n.width=r,n.height=i,o.drawImage(t,0,0,r,i),n}function bt(t){return new Promise((e=>{const n=new Image;n.src=t,n.onload=()=>e(n)}))}function vt(t){async function e(t){let e={name:t.name,url:null};const o=5e6,r=await lt(t);if(console.log(t.size),t.size>o){console.log("1");let t=await async function(t){return new Promise((async e=>{const n=document.createElement("canvas"),o=n.getContext("2d"),r=await bt(t);n.width=r.width,n.height=r.height,o.drawImage(r,0,0),n.toBlob((t=>e(t)),"image/jpeg")}))}(r);if(console.log("jpeg",t.size),t.size>o){console.log("1.1");const e=1/2**Math.ceil(Math.log2(t.size/o)),n=await bt(r);let i=await $t(n,e);t=await async function(t,e="image/jpeg"){return new Promise((async n=>{t.toBlob((t=>n(t)),e)}))}(i,"image/jpeg"),console.log("jpeg+scaled",t.size)}e.url=await wt(r,9e4),e.FullResKey=n(t)}else t.size>15e4?(console.log("2"),e.url=await wt(r,9e4),e.FullResKey=n(t)):(console.log("3"),e.url=r);st.push(e)}function n(t){const e=Date.now().toString();return tt(e,t),e}return[async t=>{const n=t.target,{files:o}=n;for(const t of o)await e(t)}]}class xt extends H{constructor(t){super(),T(this,t,vt,yt,i,{})}}async function kt(t){try{console.log("fetch",t);const e=await fetch(t);403==e.status&&console.log("forbidden, don't forget to sign into reddit"),console.log(e);return(await e.json()).data}catch(t){console.log(t)}}function _t(t,e,n){const o=t.slice();return o[20]=e[n],o}function Ct(t){let e,n,r,i,c,l,s,u,a=0==t[2]&&jt(t);return{c(){a&&a.c(),e=m("\r\n            search: "),n=p("input"),r=p("br"),i=m("\r\n            subreddits: "),c=p("input"),l=p("br"),$(n,"type","text"),$(n,"placeholder",'keywords split by " ,;"'),$(c,"type","text"),$(c,"placeholder",'keywords split by " ,;"')},m(o,f){a&&a.m(o,f),d(o,e,f),d(o,n,f),v(n,t[1]),d(o,r,f),d(o,i,f),d(o,c,f),v(c,t[0]),d(o,l,f),s||(u=[w(n,"input",t[15]),w(c,"input",t[16])],s=!0)},p(t,o){0==t[2]?a?a.p(t,o):(a=jt(t),a.c(),a.m(e.parentNode,e)):a&&(a.d(1),a=null),2&o&&n.value!==t[1]&&v(n,t[1]),1&o&&c.value!==t[0]&&v(c,t[0])},d(t){a&&a.d(t),t&&h(e),t&&h(n),t&&h(r),t&&h(i),t&&h(c),t&&h(l),s=!1,o(u)}}}function Et(t){let e,n,o,r,i;return{c(){e=m("url: "),n=p("input"),o=p("br"),$(n,"type","text")},m(c,l){d(c,e,l),d(c,n,l),v(n,t[3]),d(c,o,l),r||(i=w(n,"input",t[12]),r=!0)},p(t,e){8&e&&n.value!==t[3]&&v(n,t[3])},d(t){t&&h(e),t&&h(n),t&&h(o),r=!1,i()}}}function jt(t){let e,n,r,i,c,l,s,u,a=t[7],f=[];for(let e=0;e<a.length;e+=1)f[e]=zt(_t(t,a,e));return{c(){e=m("username: u/"),n=p("input"),r=p("br"),i=m("\r\n                category: \r\n                "),c=p("select");for(let t=0;t<f.length;t+=1)f[t].c();l=p("br"),$(n,"type","text"),void 0===t[5]&&q((()=>t[14].call(c)))},m(o,a){d(o,e,a),d(o,n,a),v(n,t[4]),d(o,r,a),d(o,i,a),d(o,c,a);for(let t=0;t<f.length;t+=1)f[t].m(c,null);x(c,t[5]),d(o,l,a),s||(u=[w(n,"input",t[13]),w(c,"change",t[14])],s=!0)},p(t,e){if(16&e&&n.value!==t[4]&&v(n,t[4]),128&e){let n;for(a=t[7],n=0;n<a.length;n+=1){const o=_t(t,a,n);f[n]?f[n].p(o,e):(f[n]=zt(o),f[n].c(),f[n].m(c,null))}for(;n<f.length;n+=1)f[n].d(1);f.length=a.length}160&e&&x(c,t[5])},d(t){t&&h(e),t&&h(n),t&&h(r),t&&h(i),t&&h(c),g(f,t),t&&h(l),s=!1,o(u)}}}function zt(e){let n,o,r,i=e[20]+"";return{c(){n=p("option"),o=m(i),n.__value=r=e[20],n.value=n.__value},m(t,e){d(t,n,e),f(n,o)},p:t,d(t){t&&h(n)}}}function Mt(e){let n,r,i,c,l,s,u,a,g,x,k,_,C,E,j,z,M,A;function R(t,e){return 2==t[2]?Et:Ct}let S=R(e),q=S(e);return{c(){n=p("div"),r=p("div"),i=p("button"),i.textContent="user",c=y(),l=p("button"),l.textContent="search",s=y(),u=p("button"),u.textContent="custom",a=y(),g=p("div"),q.c(),x=m("\r\n        count: "),k=p("input"),_=p("br"),C=m("\r\n        nsfw: "),E=p("input"),j=y(),z=p("button"),z.textContent="load",$(r,"class","head"),$(k,"type","number"),$(E,"type","checkbox"),$(g,"class","options"),$(n,"class","redditSearch")},m(t,o){d(t,n,o),f(n,r),f(r,i),f(r,c),f(r,l),f(r,s),f(r,u),f(n,a),f(n,g),q.m(g,null),f(g,x),f(g,k),v(k,e[6].count),f(g,_),f(g,C),f(g,E),E.checked=e[6].nsfw,f(n,j),f(n,z),M||(A=[w(i,"click",e[9]),w(l,"click",e[10]),w(u,"click",e[11]),w(k,"input",e[17]),w(E,"change",e[18]),w(z,"click",e[8])],M=!0)},p(t,[e]){S===(S=R(t))&&q?q.p(t,e):(q.d(1),q=S(t),q&&(q.c(),q.m(g,x))),64&e&&b(k.value)!==t[6].count&&v(k,t[6].count),64&e&&(E.checked=t[6].nsfw)},i:t,o:t,d(t){t&&h(n),q.d(),M=!1,o(A)}}}function At(t){return t.split(/[ ,;]/).filter((t=>t.trim().length>0))}function Rt(t,e,n){let o,r,i=0,c="",l="",s="",u="",a=["upvoted","posts"];return t.$$.update=()=>{3&t.$$.dirty&&n(6,r={subreddits:At(l),keywords:At(s),nsfw:!0,count:5})},[l,s,i,c,u,o,r,a,async function(){var t;let e=function(){let t="https://www.reddit.com";switch(i){case 0:t+=`/user/${u}/${o}`;break;case 1:t+=`/search/?q=${r.keywords.join(" ")}`;break;case 2:t=c}return t}(),l=e.split(/\/\?|\?/);e=`${l[0]}.json${l[1]?"?"+l[1]:""}`,1==i&&n(6,r.keywords=[],r);const s=await async function(t,e){let{subreddits:n,keywords:o,nsfw:r,count:i=10}=e;0==n.length&&(n=[""]),0==o.length&&(o=[""]);const c=(t+=t.includes("?")?"&":"?")+"include_over_18="+(r?"on":"off");n=n.map((t=>t.toLowerCase())),o=o.map((t=>t.toLowerCase()));const l=Math.min(i,100),s=[];let u=await kt(`${c}&limit=${l}`),a=u.children;const f=t=>{let e=t.data;return n.some((t=>e.subreddit.toLowerCase().includes(t)))||o.some((t=>e.title.toLowerCase().includes(t)))};for(let t=0;t<a.length;t++)f(a[t])&&s.push(a[t].data);let d=a.length;for(;(null==u?void 0:u.after)&&d<i;){u=await kt(t+"&after="+u.after),a=u.children;for(let t=0;t<a.length;t++)f(a[t])&&s.push(a[t].data);d+=a.length}return s}(e,r);for(let e of s)st.push({url:null!==(t=null==e?void 0:e.url_overridden_by_dest)&&void 0!==t?t:null==e?void 0:e.url,name:null==e?void 0:e.title})},()=>n(2,i=0),()=>n(2,i=1),()=>n(2,i=2),function(){c=this.value,n(3,c)},function(){u=this.value,n(4,u)},function(){o=function(t){const e=t.querySelector(":checked")||t.options[0];return e&&e.__value}(this),n(5,o),n(7,a)},function(){s=this.value,n(1,s)},function(){l=this.value,n(0,l)},function(){r.count=b(this.value),n(6,r),n(0,l),n(1,s)},function(){r.nsfw=this.checked,n(6,r),n(0,l),n(1,s)}]}class St extends H{constructor(t){super(),T(this,t,Rt,Mt,i,{})}}async function qt(t){return new Promise(((e,n)=>{let o=new Image;o.src=t,o.onload=function(){e(o)},o.onerror=function(t,e){n()}}))}async function Lt(t,e){const[n,o]=await async function(t){const e=await qt(t);return[e.width,e.height]}(e);return{ratio:n/o,items:[t]}}function Pt(t,e,n,o,r,i,c=0){console.log(n,o,r,i);let[l,s]=function(t,e,n){const o=t/e;return o>n?t*=n/o:e*=o/n,[t,e]}(r,i,e.ratio);return Kt(t,e,n,o,l+c,s+c,c),[l,s]}async function Kt(t,e,n,o,r,i,c=0){if(null==e.horizontal||"number"==typeof e.items[0]){let l=e.items[0];if(l<0)return;return void async function(t,e,n,o,r,i){const c=await qt(e),l=c.width/c.height,s=r/i;let u=l>s?s/l*c.width:c.width,a=l>s?c.height:l/s*c.height,f=(c.width-u)/2,d=(c.height-a)/2;t.drawImage(c,f,d,u,a,n,o,r,i)}(t,await st.getLink(l),n,o,r-c,i-c)}let l=0;if(1==e.horizontal)for(let s of e.items){let u=s.ratio/e.ratio*r;await Kt(t,s,n+l,o,u,i,c),l+=u}else for(let s of e.items){let u=e.ratio/s.ratio*i;await Kt(t,s,n,o+l,r,u,c),l+=u}}function Ft(e){let n,r,i,c,l,s,u,a,g,x,k,_,C,E,j,z,M,A,R,S,q,L,P;return{c(){n=p("div"),r=p("div"),i=m("1280x720, 1920×1080, 2560×1440, 3200×1800, 3840×2160"),c=p("br"),l=m("\r\n        width: "),s=p("input"),u=m("\r\n        height: "),a=p("input"),g=m("\r\n        margin: "),x=p("input"),k=m("\r\n        border: "),_=p("input"),C=m("\r\n        background: "),E=p("input"),j=y(),z=p("button"),z.textContent="generate",M=y(),A=p("div"),R=p("canvas"),S=y(),q=p("button"),q.textContent="snapshot",$(s,"type","number"),$(a,"type","number"),$(x,"type","number"),$(_,"type","number"),$(E,"type","color"),$(r,"class","settings"),$(R,"height",e[2]),$(R,"width",e[1]),$(R,"class","svelte-1ryfd5b"),$(A,"class","display"),$(n,"class","collagesContainer svelte-1ryfd5b")},m(t,o){d(t,n,o),f(n,r),f(r,i),f(r,c),f(r,l),f(r,s),v(s,e[1]),f(r,u),f(r,a),v(a,e[2]),f(r,g),f(r,x),v(x,e[3]),f(r,k),f(r,_),v(_,e[4]),f(r,C),f(r,E),v(E,e[5]),f(r,j),f(r,z),f(n,M),f(n,A),f(A,R),e[13](R),f(n,S),f(n,q),L||(P=[w(s,"input",e[8]),w(a,"input",e[9]),w(x,"input",e[10]),w(_,"input",e[11]),w(E,"input",e[12]),w(z,"click",e[6]),w(q,"click",e[7])],L=!0)},p(t,[e]){2&e&&b(s.value)!==t[1]&&v(s,t[1]),4&e&&b(a.value)!==t[2]&&v(a,t[2]),8&e&&b(x.value)!==t[3]&&v(x,t[3]),16&e&&b(_.value)!==t[4]&&v(_,t[4]),32&e&&v(E,t[5]),4&e&&$(R,"height",t[2]),2&e&&$(R,"width",t[1])},i:t,o:t,d(t){t&&h(n),e[13](null),L=!1,o(P)}}}function Bt(t,e,n){let o,r;C((()=>{r=o.getContext("2d"),r.imageSmoothingEnabled=!0,r.imageSmoothingQuality="high"}));let i=1280,c=720,l=5,s=10,u="#F5DEB3",a=[i,c];return[o,i,c,l,s,u,async function(){n(0,o.width=i,o),n(0,o.height=c,o),r.fillStyle=u,r.clearRect(0,0,i,c),r.fillRect(0,0,i,c);const t=await async function(t){let e=st.get();const n=[];for(let t=0;t<e.length;t++){let o=e[t];n.push(Lt(t,o.url))}let o=(await Promise.allSettled(n)).filter((t=>"fulfilled"==t.status)).map((t=>t.value));const r=o.length;o=[...o].sort(((t,e)=>t.ratio-e.ratio));let i=o.reduce(((t,e)=>t+e.ratio),0);const c=i/r;i=o.reduce(((t,e)=>t+Math.sqrt(c/e.ratio)*e.ratio),0);const l=i/Math.round(Math.sqrt(i/t));let s=[],u=0,a=0,f=0;for(let t=0;t<o.length;t++){const e=u/f;let n=l*Math.sqrt(e/c)-u;if(n<0){let e=a<-n;s.push(e?t-1:t),u=e?o[t-1].ratio:0,f=0}u+=o[t].ratio,f++,a=n}let d=0,h=[];s.push(o.length);for(let t of s){const e=o.slice(d,t),n=e.map((t=>t.ratio)).reduce(((t,e)=>t+e),0);h.push({ratio:n,horizontal:!0,items:[...e]}),d=t}const g={ratio:1/h.map((t=>t.ratio)).reduce(((t,e)=>t+1/e),0),horizontal:!1,items:[...h]};function p(t){return t.items.reduce(((t,e)=>t+e.items[0]),0)/t.items.length}g.items.sort(((t,e)=>p(t)-p(e)));for(let t of g.items)t.items.sort(((t,e)=>t.items[0]-e.items[0]));return g}(i/c),[e,f]=Pt(r,t,s,s,i-2*s,c-2*s,l);a=[e+2*s,f+2*s]},async function(){const[t,e]=a,i=await createImageBitmap(o);n(0,o.width=t,o),n(0,o.height=e,o),r.drawImage(i,0,0);const c=o.toDataURL();let l=document.createElement("a");l.href=c,l.download="collage.png",l.click()},function(){i=b(this.value),n(1,i)},function(){c=b(this.value),n(2,c)},function(){l=b(this.value),n(3,l)},function(){s=b(this.value),n(4,s)},function(){u=this.value,n(5,u)},function(t){z[t?"unshift":"push"]((()=>{o=t,n(0,o)}))}]}class It extends H{constructor(t){super(),T(this,t,Bt,Ft,i,{})}}function Dt(e){let n,o,r,i,c,l,s,u,a,g,m,w,b,v,x;return i=new St({}),l=new xt({}),g=new mt({}),v=new It({}),{c(){n=p("main"),o=p("h1"),o.textContent="1. Choose images",r=y(),N(i.$$.fragment),c=y(),N(l.$$.fragment),s=y(),u=p("h1"),u.textContent="2. Manage images",a=y(),N(g.$$.fragment),m=y(),w=p("h1"),w.textContent="3. Generate Collage",b=y(),N(v.$$.fragment),$(o,"class","svelte-enb3qt"),$(u,"class","svelte-enb3qt"),$(w,"class","svelte-enb3qt"),$(n,"class","svelte-enb3qt")},m(t,e){d(t,n,e),f(n,o),f(n,r),U(i,n,null),f(n,c),U(l,n,null),f(n,s),f(n,u),f(n,a),U(g,n,null),f(n,m),f(n,w),f(n,b),U(v,n,null),x=!0},p:t,i(t){x||(D(i.$$.fragment,t),D(l.$$.fragment,t),D(g.$$.fragment,t),D(v.$$.fragment,t),x=!0)},o(t){O(i.$$.fragment,t),O(l.$$.fragment,t),O(g.$$.fragment,t),O(v.$$.fragment,t),x=!1},d(t){t&&h(n),G(i),G(l),G(g),G(v)}}}return new class extends H{constructor(t){super(),T(this,t,null,Dt,i,{})}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map

var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function o(t){t.forEach(e)}function r(t){return"function"==typeof t}function c(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}let i,u;function l(t,e){return i||(i=document.createElement("a")),i.href=e,t===i.href}function s(e,...n){if(null==e)return t;const o=e.subscribe(...n);return o.unsubscribe?()=>o.unsubscribe():o}function a(t){let e;return s(t,(t=>e=t))(),e}function f(t,e){t.appendChild(e)}function d(t,e,n){t.insertBefore(e,n||null)}function h(t){t.parentNode.removeChild(t)}function p(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function g(t){return document.createElement(t)}function m(t){return document.createTextNode(t)}function y(){return m(" ")}function $(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function b(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function w(t){return""===t?null:+t}function v(t,e){t.value=null==e?"":e}function k(t,e){for(let n=0;n<t.options.length;n+=1){const o=t.options[n];if(o.__value===e)return void(o.selected=!0)}t.selectedIndex=-1}function x(t,e,n){t.classList[n?"add":"remove"](e)}function _(t){u=t}function C(t){(function(){if(!u)throw new Error("Function called outside component initialization");return u})().$$.on_mount.push(t)}function E(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach((t=>t.call(this,e)))}const A=[],M=[],q=[],L=[],R=Promise.resolve();let S=!1;function j(t){q.push(t)}const z=new Set;let K=0;function F(){const t=u;do{for(;K<A.length;){const t=A[K];K++,_(t),P(t.$$)}for(_(null),A.length=0,K=0;M.length;)M.pop()();for(let t=0;t<q.length;t+=1){const e=q[t];z.has(e)||(z.add(e),e())}q.length=0}while(A.length);for(;L.length;)L.pop()();S=!1,z.clear(),_(t)}function P(t){if(null!==t.fragment){t.update(),o(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(j)}}const D=new Set;let I;function O(t,e){t&&t.i&&(D.delete(t),t.i(e))}function B(t,e,n,o){if(t&&t.o){if(D.has(t))return;D.add(t),I.c.push((()=>{D.delete(t),o&&(n&&t.d(1),o())})),t.o(e)}}function N(t){t&&t.c()}function U(t,n,c,i){const{fragment:u,on_mount:l,on_destroy:s,after_update:a}=t.$$;u&&u.m(n,c),i||j((()=>{const n=l.map(e).filter(r);s?s.push(...n):o(n),t.$$.on_mount=[]})),a.forEach(j)}function G(t,e){const n=t.$$;null!==n.fragment&&(o(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function T(t,e){-1===t.$$.dirty[0]&&(A.push(t),S||(S=!0,R.then(F)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function H(e,r,c,i,l,s,a,f=[-1]){const d=u;_(e);const p=e.$$={fragment:null,ctx:null,props:s,update:t,not_equal:l,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(r.context||(d?d.$$.context:[])),callbacks:n(),dirty:f,skip_bound:!1,root:r.target||d.$$.root};a&&a(p.root);let g=!1;if(p.ctx=c?c(e,r.props||{},((t,n,...o)=>{const r=o.length?o[0]:n;return p.ctx&&l(p.ctx[t],p.ctx[t]=r)&&(!p.skip_bound&&p.bound[t]&&p.bound[t](r),g&&T(e,t)),n})):[],p.update(),g=!0,o(p.before_update),p.fragment=!!i&&i(p.ctx),r.target){if(r.hydrate){const t=function(t){return Array.from(t.childNodes)}(r.target);p.fragment&&p.fragment.l(t),t.forEach(h)}else p.fragment&&p.fragment.c();r.intro&&O(e.$$.fragment),U(e,r.target,r.anchor,r.customElement),F()}_(d)}class J{$destroy(){G(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const Q=[];function V(t){return new Promise(((e,n)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>n(t.error)}))}function W(t,e){const n=indexedDB.open(t);n.onupgradeneeded=()=>n.result.createObjectStore(e);const o=V(n);return(t,n)=>o.then((o=>n(o.transaction(e,t).objectStore(e))))}let X;function Y(){return X||(X=W("keyval-store","keyval")),X}function Z(t,e=Y()){return e("readonly",(e=>V(e.get(t))))}function tt(t,e,n=Y()){return n("readwrite",(n=>(n.put(e,t),V(n.transaction))))}function et(t,e=Y()){return e("readwrite",(e=>(e.delete(t),V(e.transaction))))}function nt(t,e){return t.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},V(t.transaction)}var ot=Object.freeze({__proto__:null,clear:function(t=Y()){return t("readwrite",(t=>(t.clear(),V(t.transaction))))},createStore:W,del:et,delMany:function(t,e=Y()){return e("readwrite",(e=>(t.forEach((t=>e.delete(t))),V(e.transaction))))},entries:function(t=Y()){return t("readonly",(e=>{if(e.getAll&&e.getAllKeys)return Promise.all([V(e.getAllKeys()),V(e.getAll())]).then((([t,e])=>t.map(((t,n)=>[t,e[n]]))));const n=[];return t("readonly",(t=>nt(t,(t=>n.push([t.key,t.value]))).then((()=>n))))}))},get:Z,getMany:function(t,e=Y()){return e("readonly",(e=>Promise.all(t.map((t=>V(e.get(t)))))))},keys:function(t=Y()){return t("readonly",(t=>{if(t.getAllKeys)return V(t.getAllKeys());const e=[];return nt(t,(t=>e.push(t.key))).then((()=>e))}))},promisifyRequest:V,set:tt,setMany:function(t,e=Y()){return e("readwrite",(e=>(t.forEach((t=>e.put(t[1],t[0]))),V(e.transaction))))},update:function(t,e,n=Y()){return n("readwrite",(n=>new Promise(((o,r)=>{n.get(t).onsuccess=function(){try{n.put(e(this.result),t),o(V(n.transaction))}catch(t){r(t)}}}))))},values:function(t=Y()){return t("readonly",(t=>{if(t.getAll)return V(t.getAll());const e=[];return nt(t,(t=>e.push(t.value))).then((()=>e))}))}});const{get:rt,set:ct}=ot,it=(e,n)=>{const o=function(e,n=t){let o;const r=new Set;function i(t){if(c(e,t)&&(e=t,o)){const t=!Q.length;for(const t of r)t[1](),Q.push(t,e);if(t){for(let t=0;t<Q.length;t+=2)Q[t][0](Q[t+1]);Q.length=0}}}return{set:i,update:function(t){i(t(e))},subscribe:function(c,u=t){const l=[c,u];return r.add(l),1===r.size&&(o=n(i)||t),c(e),()=>{r.delete(l),0===r.size&&(o(),o=null)}}}}(n);return"undefined"==typeof indexedDB||((async()=>{const t=await rt(e);null!=t&&o.set(t)})(),o.subscribe((t=>{ct(e,t)}))),o},ut=function(){const{subscribe:t,update:e,set:n}=it("chosen-images",[]);return{subscribe:t,push:(...t)=>{console.log("push",t[0].url),e((e=>[...e,...t]))},delete:(...t)=>{e((e=>{var n;for(let o of t)(null===(n=e[o])||void 0===n?void 0:n.FullResKey)&&et(e[o].FullResKey),e[o]=null;return e.filter((t=>t))}))},get:()=>a(ut),getLink:async t=>{const e=a(ut)[t];return e.FullResKey?await Z(e.FullResKey):e.url}}}();function lt(e){let n,o,r,c,i;return{c(){n=g("img"),l(n.src,o=e[0].url)||b(n,"src",o),b(n,"alt",r=e[0].name),b(n,"class","svelte-9h94g7"),x(n,"selected",e[1])},m(t,o){d(t,n,o),c||(i=$(n,"click",e[2]),c=!0)},p(t,[e]){1&e&&!l(n.src,o=t[0].url)&&b(n,"src",o),1&e&&r!==(r=t[0].name)&&b(n,"alt",r),2&e&&x(n,"selected",t[1])},i:t,o:t,d(t){t&&h(n),c=!1,i()}}}function st(t,e,n){let{data:o}=e,{selected:r}=e;return t.$$set=t=>{"data"in t&&n(0,o=t.data),"selected"in t&&n(1,r=t.selected)},[o,r,function(e){E.call(this,t,e)}]}class at extends J{constructor(t){super(),H(this,t,st,lt,c,{data:0,selected:1})}}function ft(t,e,n){const o=t.slice();return o[6]=e[n],o[8]=n,o}function dt(t){let e,n;return e=new at({props:{data:t[6],selected:t[0][t[8]]}}),e.$on("click",(function(){return t[5](t[8])})),{c(){N(e.$$.fragment)},m(t,o){U(e,t,o),n=!0},p(n,o){t=n;const r={};2&o&&(r.data=t[6]),1&o&&(r.selected=t[0][t[8]]),e.$set(r)},i(t){n||(O(e.$$.fragment,t),n=!0)},o(t){B(e.$$.fragment,t),n=!1},d(t){G(e,t)}}}function ht(t){let e,n,r,c,i,u,l,s,a,m,w,v,k=t[1],x=[];for(let e=0;e<k.length;e+=1)x[e]=dt(ft(t,k,e));const _=t=>B(x[t],1,1,(()=>{x[t]=null}));return{c(){e=g("div"),n=g("div"),r=g("button"),r.textContent="delete",c=y(),i=g("button"),i.textContent="unselect",u=y(),l=g("button"),l.textContent="invert selection",s=y(),a=g("div");for(let t=0;t<x.length;t+=1)x[t].c();b(n,"class","header"),b(a,"class","content svelte-115ye2s"),b(e,"class","gallery")},m(o,h){d(o,e,h),f(e,n),f(n,r),f(n,c),f(n,i),f(n,u),f(n,l),f(e,s),f(e,a);for(let t=0;t<x.length;t+=1)x[t].m(a,null);m=!0,w||(v=[$(r,"click",t[2]),$(i,"click",t[4]),$(l,"click",t[3])],w=!0)},p(t,[e]){if(3&e){let n;for(k=t[1],n=0;n<k.length;n+=1){const o=ft(t,k,n);x[n]?(x[n].p(o,e),O(x[n],1)):(x[n]=dt(o),x[n].c(),O(x[n],1),x[n].m(a,null))}for(I={r:0,c:[],p:I},n=k.length;n<x.length;n+=1)_(n);I.r||o(I.c),I=I.p}},i(t){if(!m){for(let t=0;t<k.length;t+=1)O(x[t]);m=!0}},o(t){x=x.filter(Boolean);for(let t=0;t<x.length;t+=1)B(x[t]);m=!1},d(t){t&&h(e),p(x,t),w=!1,o(v)}}}function pt(t,e,n){let o;var r,c;r=ut,c=t=>n(1,o=t),t.$$.on_destroy.push(s(r,c));let i={};return[i,o,function(){const t=Object.entries(i).filter((t=>t[1])).map((t=>Number(t[0])));ut.delete(...t),n(0,i={})},function(){n(0,i=Object.fromEntries(o.map(((t,e)=>[e,!i[e]]))))},()=>n(0,i={}),t=>n(0,i[t]=!i[t],i)]}class gt extends J{constructor(t){super(),H(this,t,pt,ht,c,{})}}function mt(e){let n,o,r;return{c(){n=g("input"),b(n,"type","file"),n.multiple=!0,b(n,"accept","image/*")},m(t,c){d(t,n,c),o||(r=$(n,"change",e[0]),o=!0)},p:t,i:t,o:t,d(t){t&&h(n),o=!1,r()}}}async function yt(t,e){const n=document.createElement("canvas"),o=n.getContext("2d"),r=await function(t){return new Promise((e=>{const n=new Image;n.src=t,n.onload=()=>e(n)}))}(t),c=r.width*r.height,i=Math.sqrt(e/c),u=Math.round(r.width*i),l=Math.round(r.height*i);return n.width=u,n.height=l,o.drawImage(r,0,0,u,l),n.toDataURL()}function $t(t){function e(t){const e=new FileReader;e.readAsDataURL(t),e.onload=async()=>{if("string"==typeof e.result){const n=e.result;let o={name:t.name,url:n};const r=9e4,c=15e4;t.size>c&&(console.log(t.size),o.url=await yt(n,r),o.FullResKey=function(t){const e=Date.now().toString();return tt(e,t),e}(n)),ut.push(o)}}}return[async t=>{const n=t.target,{files:o}=n;for(const t of o)e(t)}]}class bt extends J{constructor(t){super(),H(this,t,$t,mt,c,{})}}async function wt(t){try{console.log("fetch",t);const e=await fetch(t);403==e.status&&console.log("forbidden, don't forget to sign into reddit"),console.log(e);return(await e.json()).data}catch(t){console.log(t)}}function vt(t,e,n){const o=t.slice();return o[20]=e[n],o}function kt(t){let e,n,r,c,i,u,l,s,a=0==t[2]&&_t(t);return{c(){a&&a.c(),e=m("\r\n            search: "),n=g("input"),r=g("br"),c=m("\r\n            subreddits: "),i=g("input"),u=g("br"),b(n,"type","text"),b(n,"placeholder",'keywords split by " ,;"'),b(i,"type","text"),b(i,"placeholder",'keywords split by " ,;"')},m(o,f){a&&a.m(o,f),d(o,e,f),d(o,n,f),v(n,t[1]),d(o,r,f),d(o,c,f),d(o,i,f),v(i,t[0]),d(o,u,f),l||(s=[$(n,"input",t[15]),$(i,"input",t[16])],l=!0)},p(t,o){0==t[2]?a?a.p(t,o):(a=_t(t),a.c(),a.m(e.parentNode,e)):a&&(a.d(1),a=null),2&o&&n.value!==t[1]&&v(n,t[1]),1&o&&i.value!==t[0]&&v(i,t[0])},d(t){a&&a.d(t),t&&h(e),t&&h(n),t&&h(r),t&&h(c),t&&h(i),t&&h(u),l=!1,o(s)}}}function xt(t){let e,n,o,r,c;return{c(){e=m("url: "),n=g("input"),o=g("br"),b(n,"type","text")},m(i,u){d(i,e,u),d(i,n,u),v(n,t[3]),d(i,o,u),r||(c=$(n,"input",t[12]),r=!0)},p(t,e){8&e&&n.value!==t[3]&&v(n,t[3])},d(t){t&&h(e),t&&h(n),t&&h(o),r=!1,c()}}}function _t(t){let e,n,r,c,i,u,l,s,a=t[7],f=[];for(let e=0;e<a.length;e+=1)f[e]=Ct(vt(t,a,e));return{c(){e=m("username: u/"),n=g("input"),r=g("br"),c=m("\r\n                category: \r\n                "),i=g("select");for(let t=0;t<f.length;t+=1)f[t].c();u=g("br"),b(n,"type","text"),void 0===t[5]&&j((()=>t[14].call(i)))},m(o,a){d(o,e,a),d(o,n,a),v(n,t[4]),d(o,r,a),d(o,c,a),d(o,i,a);for(let t=0;t<f.length;t+=1)f[t].m(i,null);k(i,t[5]),d(o,u,a),l||(s=[$(n,"input",t[13]),$(i,"change",t[14])],l=!0)},p(t,e){if(16&e&&n.value!==t[4]&&v(n,t[4]),128&e){let n;for(a=t[7],n=0;n<a.length;n+=1){const o=vt(t,a,n);f[n]?f[n].p(o,e):(f[n]=Ct(o),f[n].c(),f[n].m(i,null))}for(;n<f.length;n+=1)f[n].d(1);f.length=a.length}160&e&&k(i,t[5])},d(t){t&&h(e),t&&h(n),t&&h(r),t&&h(c),t&&h(i),p(f,t),t&&h(u),l=!1,o(s)}}}function Ct(e){let n,o,r,c=e[20]+"";return{c(){n=g("option"),o=m(c),n.__value=r=e[20],n.value=n.__value},m(t,e){d(t,n,e),f(n,o)},p:t,d(t){t&&h(n)}}}function Et(e){let n,r,c,i,u,l,s,a,p,k,x,_,C,E,A,M,q,L;function R(t,e){return 2==t[2]?xt:kt}let S=R(e),j=S(e);return{c(){n=g("div"),r=g("div"),c=g("button"),c.textContent="user",i=y(),u=g("button"),u.textContent="search",l=y(),s=g("button"),s.textContent="custom",a=y(),p=g("div"),j.c(),k=m("\r\n        count: "),x=g("input"),_=g("br"),C=m("\r\n        nsfw: "),E=g("input"),A=y(),M=g("button"),M.textContent="load",b(r,"class","head"),b(x,"type","number"),b(E,"type","checkbox"),b(p,"class","options"),b(n,"class","redditSearch")},m(t,o){d(t,n,o),f(n,r),f(r,c),f(r,i),f(r,u),f(r,l),f(r,s),f(n,a),f(n,p),j.m(p,null),f(p,k),f(p,x),v(x,e[6].count),f(p,_),f(p,C),f(p,E),E.checked=e[6].nsfw,f(n,A),f(n,M),q||(L=[$(c,"click",e[9]),$(u,"click",e[10]),$(s,"click",e[11]),$(x,"input",e[17]),$(E,"change",e[18]),$(M,"click",e[8])],q=!0)},p(t,[e]){S===(S=R(t))&&j?j.p(t,e):(j.d(1),j=S(t),j&&(j.c(),j.m(p,k))),64&e&&w(x.value)!==t[6].count&&v(x,t[6].count),64&e&&(E.checked=t[6].nsfw)},i:t,o:t,d(t){t&&h(n),j.d(),q=!1,o(L)}}}function At(t){return t.split(/[ ,;]/).filter((t=>t.trim().length>0))}function Mt(t,e,n){let o,r,c=0,i="",u="",l="",s="",a=["upvoted","posts"];return t.$$.update=()=>{3&t.$$.dirty&&n(6,r={subreddits:At(u),keywords:At(l),nsfw:!0,count:5})},[u,l,c,i,s,o,r,a,async function(){var t;let e=function(){let t="https://www.reddit.com";switch(c){case 0:t+=`/user/${s}/${o}`;break;case 1:t+=`/search/?q=${r.keywords.join(" ")}`;break;case 2:t=i}return t}(),u=e.split(/\/\?|\?/);e=`${u[0]}.json${u[1]?"?"+u[1]:""}`,1==c&&n(6,r.keywords=[],r);const l=await async function(t,e){let{subreddits:n,keywords:o,nsfw:r,count:c=10}=e;0==n.length&&(n=[""]),0==o.length&&(o=[""]);const i=(t+=t.includes("?")?"&":"?")+"include_over_18="+(r?"on":"off");n=n.map((t=>t.toLowerCase())),o=o.map((t=>t.toLowerCase()));const u=Math.min(c,100),l=[];let s=await wt(`${i}&limit=${u}`),a=s.children;const f=t=>{let e=t.data;return n.some((t=>e.subreddit.toLowerCase().includes(t)))||o.some((t=>e.title.toLowerCase().includes(t)))};for(let t=0;t<a.length;t++)f(a[t])&&l.push(a[t].data);let d=a.length;for(;(null==s?void 0:s.after)&&d<c;){s=await wt(t+"&after="+s.after),a=s.children;for(let t=0;t<a.length;t++)f(a[t])&&l.push(a[t].data);d+=a.length}return l}(e,r);for(let e of l)ut.push({url:null!==(t=null==e?void 0:e.url_overridden_by_dest)&&void 0!==t?t:null==e?void 0:e.url,name:null==e?void 0:e.title})},()=>n(2,c=0),()=>n(2,c=1),()=>n(2,c=2),function(){i=this.value,n(3,i)},function(){s=this.value,n(4,s)},function(){o=function(t){const e=t.querySelector(":checked")||t.options[0];return e&&e.__value}(this),n(5,o),n(7,a)},function(){l=this.value,n(1,l)},function(){u=this.value,n(0,u)},function(){r.count=w(this.value),n(6,r),n(0,u),n(1,l)},function(){r.nsfw=this.checked,n(6,r),n(0,u),n(1,l)}]}class qt extends J{constructor(t){super(),H(this,t,Mt,Et,c,{})}}async function Lt(t){return new Promise(((e,n)=>{let o=new Image;o.src=t,o.onload=function(){e(o)},o.onerror=function(t,e){n()}}))}async function Rt(t,e){const[n,o]=await async function(t){const e=await Lt(t);return[e.width,e.height]}(e);return{ratio:n/o,items:[t]}}function St(t,e,n,o,r,c,i=0){console.log(n,o,r,c);let[u,l]=function(t,e,n){const o=t/e;return o>n?t*=n/o:e*=o/n,[t,e]}(r,c,e.ratio);return jt(t,e,n,o,u+i,l+i,i),[u,l]}async function jt(t,e,n,o,r,c,i=0){if(null==e.horizontal||"number"==typeof e.items[0]){let u=e.items[0];if(u<0)return;return void async function(t,e,n,o,r,c){const i=await Lt(e),u=i.width/i.height,l=r/c;let s=u>l?l/u*i.width:i.width,a=u>l?i.height:u/l*i.height,f=(i.width-s)/2,d=(i.height-a)/2;t.drawImage(i,f,d,s,a,n,o,r,c)}(t,await ut.getLink(u),n,o,r-i,c-i)}let u=0;if(1==e.horizontal)for(let l of e.items){let s=l.ratio/e.ratio*r;jt(t,l,n+u,o,s,c,i),u+=s}else for(let l of e.items){let s=e.ratio/l.ratio*c;jt(t,l,n,o+u,r,s,i),u+=s}}function zt(e){let n,r,c,i,u,l,s,a,p,k,x,_,C,E,A,M,q,L,R,S,j;return{c(){n=g("div"),r=g("div"),c=m("width: "),i=g("input"),u=m("\r\n        height: "),l=g("input"),s=m("\r\n        margin: "),a=g("input"),p=m("\r\n        border: "),k=g("input"),x=m("\r\n        background: "),_=g("input"),C=y(),E=g("button"),E.textContent="generate",A=y(),M=g("div"),q=g("canvas"),L=y(),R=g("button"),R.textContent="snapshot",b(i,"type","number"),b(l,"type","number"),b(a,"type","number"),b(k,"type","number"),b(_,"type","color"),b(r,"class","settings"),b(q,"height",e[2]),b(q,"width",e[1]),b(q,"class","svelte-1ryfd5b"),b(M,"class","display"),b(n,"class","collagesContainer svelte-1ryfd5b")},m(t,o){d(t,n,o),f(n,r),f(r,c),f(r,i),v(i,e[1]),f(r,u),f(r,l),v(l,e[2]),f(r,s),f(r,a),v(a,e[3]),f(r,p),f(r,k),v(k,e[4]),f(r,x),f(r,_),v(_,e[5]),f(r,C),f(r,E),f(n,A),f(n,M),f(M,q),e[13](q),f(n,L),f(n,R),S||(j=[$(i,"input",e[8]),$(l,"input",e[9]),$(a,"input",e[10]),$(k,"input",e[11]),$(_,"input",e[12]),$(E,"click",e[6]),$(R,"click",e[7])],S=!0)},p(t,[e]){2&e&&w(i.value)!==t[1]&&v(i,t[1]),4&e&&w(l.value)!==t[2]&&v(l,t[2]),8&e&&w(a.value)!==t[3]&&v(a,t[3]),16&e&&w(k.value)!==t[4]&&v(k,t[4]),32&e&&v(_,t[5]),4&e&&b(q,"height",t[2]),2&e&&b(q,"width",t[1])},i:t,o:t,d(t){t&&h(n),e[13](null),S=!1,o(j)}}}function Kt(t,e,n){let o,r;C((()=>{r=o.getContext("2d"),r.imageSmoothingEnabled=!0}));let c=1280,i=720,u=5,l=10,s="#F5DEB3",a=[c,i];return[o,c,i,u,l,s,async function(){n(0,o.width=c,o),n(0,o.height=i,o),r.fillStyle=s,r.clearRect(0,0,c,i),r.fillRect(0,0,c,i);const t=await async function(t){let e=ut.get();const n=[];for(let t=0;t<e.length;t++){let o=e[t];n.push(Rt(t,o.url))}let o=(await Promise.allSettled(n)).filter((t=>"fulfilled"==t.status)).map((t=>t.value));const r=o.length;o=[...o].sort(((t,e)=>t.ratio-e.ratio));let c=o.reduce(((t,e)=>t+e.ratio),0);const i=c/r;c=o.reduce(((t,e)=>t+Math.sqrt(i/e.ratio)*e.ratio),0);const u=c/Math.round(Math.sqrt(c/t));let l=[],s=0,a=0,f=0;for(let t=0;t<o.length;t++){const e=s/f;let n=u*Math.sqrt(e/i)-s;if(n<0){let e=a<-n;l.push(e?t-1:t),s=e?o[t-1].ratio:0,f=0}s+=o[t].ratio,f++,a=n}let d=0,h=[];l.push(o.length);for(let t of l){const e=o.slice(d,t),n=e.map((t=>t.ratio)).reduce(((t,e)=>t+e),0);h.push({ratio:n,horizontal:!0,items:[...e]}),d=t}const p={ratio:1/h.map((t=>t.ratio)).reduce(((t,e)=>t+1/e),0),horizontal:!1,items:[...h]};function g(t){return t.items.reduce(((t,e)=>t+e.items[0]),0)/t.items.length}p.items.sort(((t,e)=>g(t)-g(e)));for(let t of p.items)t.items.sort(((t,e)=>t.items[0]-e.items[0]));return p}(c/i),[e,f]=St(r,t,l,l,c-2*l,i-2*l,u);a=[e+2*l,f+2*l]},async function(){const[t,e]=a,c=await createImageBitmap(o);n(0,o.width=t,o),n(0,o.height=e,o),r.drawImage(c,0,0);const i=o.toDataURL();let u=document.createElement("a");u.href=i,u.download="collage.png",u.click()},function(){c=w(this.value),n(1,c)},function(){i=w(this.value),n(2,i)},function(){u=w(this.value),n(3,u)},function(){l=w(this.value),n(4,l)},function(){s=this.value,n(5,s)},function(t){M[t?"unshift":"push"]((()=>{o=t,n(0,o)}))}]}class Ft extends J{constructor(t){super(),H(this,t,Kt,zt,c,{})}}function Pt(e){let n,o,r,c,i,u,l,s,a,p,m,$,w,v,k;return c=new qt({}),u=new bt({}),p=new gt({}),v=new Ft({}),{c(){n=g("main"),o=g("h1"),o.textContent="1. Choose images",r=y(),N(c.$$.fragment),i=y(),N(u.$$.fragment),l=y(),s=g("h1"),s.textContent="2. Manage images",a=y(),N(p.$$.fragment),m=y(),$=g("h1"),$.textContent="3. Generate Collage",w=y(),N(v.$$.fragment),b(o,"class","svelte-enb3qt"),b(s,"class","svelte-enb3qt"),b($,"class","svelte-enb3qt"),b(n,"class","svelte-enb3qt")},m(t,e){d(t,n,e),f(n,o),f(n,r),U(c,n,null),f(n,i),U(u,n,null),f(n,l),f(n,s),f(n,a),U(p,n,null),f(n,m),f(n,$),f(n,w),U(v,n,null),k=!0},p:t,i(t){k||(O(c.$$.fragment,t),O(u.$$.fragment,t),O(p.$$.fragment,t),O(v.$$.fragment,t),k=!0)},o(t){B(c.$$.fragment,t),B(u.$$.fragment,t),B(p.$$.fragment,t),B(v.$$.fragment,t),k=!1},d(t){t&&h(n),G(c),G(u),G(p),G(v)}}}return new class extends J{constructor(t){super(),H(this,t,null,Pt,c,{})}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map

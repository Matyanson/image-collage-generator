(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))r(l);new MutationObserver(l=>{for(const i of l)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(l){const i={};return l.integrity&&(i.integrity=l.integrity),l.referrerpolicy&&(i.referrerPolicy=l.referrerpolicy),l.crossorigin==="use-credentials"?i.credentials="include":l.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(l){if(l.ep)return;l.ep=!0;const i=n(l);fetch(l.href,i)}})();function M(){}function Re(t){return t()}function pe(){return Object.create(null)}function P(t){t.forEach(Re)}function Fe(t){return typeof t=="function"}function U(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}let ne;function me(t,e){return ne||(ne=document.createElement("a")),ne.href=e,t===ne.href}function Oe(t){return Object.keys(t).length===0}function Ee(t,...e){if(t==null)return M;const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function he(t){let e;return Ee(t,n=>e=n)(),e}function Pe(t,e,n){t.$$.on_destroy.push(Ee(e,n))}function _(t,e){t.appendChild(e)}function I(t,e,n){t.insertBefore(e,n||null)}function R(t){t.parentNode.removeChild(t)}function Ie(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function b(t){return document.createElement(t)}function F(t){return document.createTextNode(t)}function A(){return F(" ")}function E(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function w(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function G(t){return t===""?null:+t}function qe(t){return Array.from(t.childNodes)}function j(t,e){t.value=e==null?"":e}function _e(t,e){for(let n=0;n<t.options.length;n+=1){const r=t.options[n];if(r.__value===e){r.selected=!0;return}}t.selectedIndex=-1}function Ge(t){const e=t.querySelector(":checked")||t.options[0];return e&&e.__value}function ge(t,e,n){t.classList[n?"add":"remove"](e)}let ee;function x(t){ee=t}function Ke(){if(!ee)throw new Error("Function called outside component initialization");return ee}function We(t){Ke().$$.on_mount.push(t)}function Be(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach(r=>r.call(this,e))}const J=[],ce=[],le=[],be=[],Ne=Promise.resolve();let ae=!1;function Te(){ae||(ae=!0,Ne.then(Le))}function ie(t){le.push(t)}const se=new Set;let re=0;function Le(){const t=ee;do{for(;re<J.length;){const e=J[re];re++,x(e),Ue(e.$$)}for(x(null),J.length=0,re=0;ce.length;)ce.pop()();for(let e=0;e<le.length;e+=1){const n=le[e];se.has(n)||(se.add(n),n())}le.length=0}while(J.length);for(;be.length;)be.pop()();ae=!1,se.clear(),x(t)}function Ue(t){if(t.fragment!==null){t.update(),P(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(ie)}}const oe=new Set;let N;function He(){N={r:0,c:[],p:N}}function Qe(){N.r||P(N.c),N=N.p}function W(t,e){t&&t.i&&(oe.delete(t),t.i(e))}function T(t,e,n,r){if(t&&t.o){if(oe.has(t))return;oe.add(t),N.c.push(()=>{oe.delete(t),r&&(n&&t.d(1),r())}),t.o(e)}}function Z(t){t&&t.c()}function Q(t,e,n,r){const{fragment:l,on_mount:i,on_destroy:o,after_update:c}=t.$$;l&&l.m(e,n),r||ie(()=>{const f=i.map(Re).filter(Fe);o?o.push(...f):P(f),t.$$.on_mount=[]}),c.forEach(ie)}function V(t,e){const n=t.$$;n.fragment!==null&&(P(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function Ve(t,e){t.$$.dirty[0]===-1&&(J.push(t),Te(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function X(t,e,n,r,l,i,o,c=[-1]){const f=ee;x(t);const s=t.$$={fragment:null,ctx:null,props:i,update:M,not_equal:l,bound:pe(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(f?f.$$.context:[])),callbacks:pe(),dirty:c,skip_bound:!1,root:e.target||f.$$.root};o&&o(s.root);let u=!1;if(s.ctx=n?n(t,e.props||{},(a,g,...d)=>{const p=d.length?d[0]:g;return s.ctx&&l(s.ctx[a],s.ctx[a]=p)&&(!s.skip_bound&&s.bound[a]&&s.bound[a](p),u&&Ve(t,a)),g}):[],s.update(),u=!0,P(s.before_update),s.fragment=r?r(s.ctx):!1,e.target){if(e.hydrate){const a=qe(e.target);s.fragment&&s.fragment.l(a),a.forEach(R)}else s.fragment&&s.fragment.c();e.intro&&W(t.$$.fragment),Q(t,e.target,e.anchor,e.customElement),Le()}x(f)}class Y{$destroy(){V(this,1),this.$destroy=M}$on(e,n){const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(n),()=>{const l=r.indexOf(n);l!==-1&&r.splice(l,1)}}$set(e){this.$$set&&!Oe(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const H=[];function Xe(t,e=M){let n;const r=new Set;function l(c){if(U(t,c)&&(t=c,n)){const f=!H.length;for(const s of r)s[1](),H.push(s,t);if(f){for(let s=0;s<H.length;s+=2)H[s][0](H[s+1]);H.length=0}}}function i(c){l(c(t))}function o(c,f=M){const s=[c,f];return r.add(s),r.size===1&&(n=e(l)||M),c(t),()=>{r.delete(s),r.size===0&&(n(),n=null)}}return{set:l,update:i,subscribe:o}}function O(t){return new Promise((e,n)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>n(t.error)})}function je(t,e){const n=indexedDB.open(t);n.onupgradeneeded=()=>n.result.createObjectStore(e);const r=O(n);return(l,i)=>r.then(o=>i(o.transaction(e,l).objectStore(e)))}let ue;function q(){return ue||(ue=je("keyval-store","keyval")),ue}function Ae(t,e=q()){return e("readonly",n=>O(n.get(t)))}function Me(t,e,n=q()){return n("readwrite",r=>(r.put(e,t),O(r.transaction)))}function Ye(t,e=q()){return e("readwrite",n=>(t.forEach(r=>n.put(r[1],r[0])),O(n.transaction)))}function Je(t,e=q()){return e("readonly",n=>Promise.all(t.map(r=>O(n.get(r)))))}function Ze(t,e,n=q()){return n("readwrite",r=>new Promise((l,i)=>{r.get(t).onsuccess=function(){try{r.put(e(this.result),t),l(O(r.transaction))}catch(o){i(o)}}}))}function ze(t,e=q()){return e("readwrite",n=>(n.delete(t),O(n.transaction)))}function xe(t,e=q()){return e("readwrite",n=>(t.forEach(r=>n.delete(r)),O(n.transaction)))}function et(t=q()){return t("readwrite",e=>(e.clear(),O(e.transaction)))}function de(t,e){return t.openCursor().onsuccess=function(){!this.result||(e(this.result),this.result.continue())},O(t.transaction)}function tt(t=q()){return t("readonly",e=>{if(e.getAllKeys)return O(e.getAllKeys());const n=[];return de(e,r=>n.push(r.key)).then(()=>n)})}function nt(t=q()){return t("readonly",e=>{if(e.getAll)return O(e.getAll());const n=[];return de(e,r=>n.push(r.value)).then(()=>n)})}function rt(t=q()){return t("readonly",e=>{if(e.getAll&&e.getAllKeys)return Promise.all([O(e.getAllKeys()),O(e.getAll())]).then(([r,l])=>r.map((i,o)=>[i,l[o]]));const n=[];return t("readonly",r=>de(r,l=>n.push([l.key,l.value])).then(()=>n))})}const lt=Object.freeze(Object.defineProperty({__proto__:null,clear:et,createStore:je,del:ze,delMany:xe,entries:rt,get:Ae,getMany:Je,keys:tt,promisifyRequest:O,set:Me,setMany:Ye,update:Ze,values:nt},Symbol.toStringTag,{value:"Module"})),{get:ot,set:it}=lt,st=(t,e)=>{const n=Xe(e);return typeof indexedDB>"u"||((async()=>{const r=await ot(t);r!=null&&n.set(r)})(),n.subscribe(r=>{it(t,r)})),n};function ut(t){return new Promise(e=>{const n=new FileReader;n.readAsDataURL(t),n.onload=async()=>{typeof n.result=="string"&&e(n.result)}})}const B=ct();function ct(){const{subscribe:t,update:e,set:n}=st("chosen-images",[]);return{subscribe:t,push:(...r)=>{e(l=>[...l,...r])},delete:(...r)=>{e(l=>{var i;for(let o of r)(i=l[o])!=null&&i.FullResKey&&ze(l[o].FullResKey),l[o]=null;return l.filter(o=>o)})},get:()=>he(B),getLink:async r=>{const l=he(B)[r];if(l.FullResKey){const i=await Ae(l.FullResKey);return await ut(i)}return l.url}}}function at(t){let e,n,r,l,i;return{c(){e=b("img"),me(e.src,n=t[0].url)||w(e,"src",n),w(e,"alt",r=t[0].name),w(e,"class","svelte-9h94g7"),ge(e,"selected",t[1])},m(o,c){I(o,e,c),l||(i=E(e,"click",t[2]),l=!0)},p(o,[c]){c&1&&!me(e.src,n=o[0].url)&&w(e,"src",n),c&1&&r!==(r=o[0].name)&&w(e,"alt",r),c&2&&ge(e,"selected",o[1])},i:M,o:M,d(o){o&&R(e),l=!1,i()}}}function ft(t,e,n){let{data:r}=e,{selected:l}=e;function i(o){Be.call(this,t,o)}return t.$$set=o=>{"data"in o&&n(0,r=o.data),"selected"in o&&n(1,l=o.selected)},[r,l,i]}class dt extends Y{constructor(e){super(),X(this,e,ft,at,U,{data:0,selected:1})}}function ye(t,e,n){const r=t.slice();return r[6]=e[n],r[8]=n,r}function we(t){let e,n;function r(){return t[5](t[8])}return e=new dt({props:{data:t[6],selected:t[0][t[8]]}}),e.$on("click",r),{c(){Z(e.$$.fragment)},m(l,i){Q(e,l,i),n=!0},p(l,i){t=l;const o={};i&2&&(o.data=t[6]),i&1&&(o.selected=t[0][t[8]]),e.$set(o)},i(l){n||(W(e.$$.fragment,l),n=!0)},o(l){T(e.$$.fragment,l),n=!1},d(l){V(e,l)}}}function pt(t){let e,n,r,l,i,o,c,f,s,u,a,g,d=t[1],p=[];for(let h=0;h<d.length;h+=1)p[h]=we(ye(t,d,h));const L=h=>T(p[h],1,1,()=>{p[h]=null});return{c(){e=b("div"),n=b("div"),r=b("button"),r.textContent="delete",l=A(),i=b("button"),i.textContent="unselect",o=A(),c=b("button"),c.textContent="invert selection",f=A(),s=b("div");for(let h=0;h<p.length;h+=1)p[h].c();w(n,"class","header"),w(s,"class","content svelte-115ye2s"),w(e,"class","gallery")},m(h,C){I(h,e,C),_(e,n),_(n,r),_(n,l),_(n,i),_(n,o),_(n,c),_(e,f),_(e,s);for(let k=0;k<p.length;k+=1)p[k].m(s,null);u=!0,a||(g=[E(r,"click",t[2]),E(i,"click",t[4]),E(c,"click",t[3])],a=!0)},p(h,[C]){if(C&3){d=h[1];let k;for(k=0;k<d.length;k+=1){const $=ye(h,d,k);p[k]?(p[k].p($,C),W(p[k],1)):(p[k]=we($),p[k].c(),W(p[k],1),p[k].m(s,null))}for(He(),k=d.length;k<p.length;k+=1)L(k);Qe()}},i(h){if(!u){for(let C=0;C<d.length;C+=1)W(p[C]);u=!0}},o(h){p=p.filter(Boolean);for(let C=0;C<p.length;C+=1)T(p[C]);u=!1},d(h){h&&R(e),Ie(p,h),a=!1,P(g)}}}function mt(t,e,n){let r;Pe(t,B,s=>n(1,r=s));let l={};function i(){const s=Object.entries(l).filter(u=>u[1]).map(u=>Number(u[0]));B.delete(...s),n(0,l={})}function o(){n(0,l=Object.fromEntries(r.map((s,u)=>[u,!l[u]])))}return[l,r,i,o,()=>n(0,l={}),s=>n(0,l[s]=!l[s],l)]}class ht extends Y{constructor(e){super(),X(this,e,mt,pt,U,{})}}function _t(){return new Worker("/assets/worker.6c25f603.js")}function gt(t){let e,n,r,l,i;return{c(){e=b("input"),n=A(),r=b("button"),r.textContent="stop upload",w(e,"type","file"),e.multiple=!0,w(e,"accept","image/*")},m(o,c){I(o,e,c),I(o,n,c),I(o,r,c),l||(i=[E(e,"change",t[0]),E(r,"click",t[1])],l=!0)},p:M,i:M,o:M,d(o){o&&R(e),o&&R(n),o&&R(r),l=!1,P(i)}}}function bt(t){let e;const n=async s=>{const u=s.target,{files:a}=u;i(),l({type:"process_batch",data:[...a]})},r=s=>{const u={name:s.name,url:s.thumbnail};s.largeSize&&(u.FullResKey=f(s.largeSize)),B.push(u)},l=s=>{typeof Worker>"u"||!e||e.postMessage(s)},i=()=>{typeof Worker>"u"||e||(e=new _t,e.onmessage=c)},o=()=>{console.log("closing worker"),e&&e.terminate(),e=void 0},c=s=>{const u=s.data;switch(u.type){case"process":r(u.data);break;default:console.log("undefined message type");break}};function f(s){const u=Date.now().toString();return Me(u,s),u}return[n,o]}class yt extends Y{constructor(e){super(),X(this,e,bt,gt,U,{})}}async function wt(t,e){let{subreddits:n,keywords:r,nsfw:l,count:i=10}=e;n.length==0&&(n=[""]),r.length==0&&(r=[""]),t+=t.includes("?")?"&":"?";const o=t+"include_over_18="+(l?"on":"off");n=n.map(d=>d.toLowerCase()),r=r.map(d=>d.toLowerCase());const c=Math.min(i,100),f=[];let s=await ke(`${o}&limit=${c}`),u=s.children;const a=d=>{let p=d.data;return n.some(L=>p.subreddit.toLowerCase().includes(L))||r.some(L=>p.title.toLowerCase().includes(L))};for(let d=0;d<u.length;d++)a(u[d])&&f.push(u[d].data);let g=u.length;for(;(s==null?void 0:s.after)&&g<i;){s=await ke(t+"&after="+s.after),u=s.children;for(let d=0;d<u.length;d++)a(u[d])&&f.push(u[d].data);g+=u.length}return f}async function ke(t){try{console.log("fetch",t);const e=await fetch(t);return e.status==403&&console.log("forbidden, don't forget to sign into reddit"),console.log(e),(await e.json()).data}catch(e){console.log(e)}}function ve(t,e,n){const r=t.slice();return r[20]=e[n],r}function kt(t){let e,n,r,l,i,o,c,f,s=t[2]==0&&Ce(t);return{c(){s&&s.c(),e=F(`\r
            search: `),n=b("input"),r=b("br"),l=F(`\r
            subreddits: `),i=b("input"),o=b("br"),w(n,"type","text"),w(n,"placeholder",'keywords split by " ,;"'),w(i,"type","text"),w(i,"placeholder",'keywords split by " ,;"')},m(u,a){s&&s.m(u,a),I(u,e,a),I(u,n,a),j(n,t[1]),I(u,r,a),I(u,l,a),I(u,i,a),j(i,t[0]),I(u,o,a),c||(f=[E(n,"input",t[15]),E(i,"input",t[16])],c=!0)},p(u,a){u[2]==0?s?s.p(u,a):(s=Ce(u),s.c(),s.m(e.parentNode,e)):s&&(s.d(1),s=null),a&2&&n.value!==u[1]&&j(n,u[1]),a&1&&i.value!==u[0]&&j(i,u[0])},d(u){s&&s.d(u),u&&R(e),u&&R(n),u&&R(r),u&&R(l),u&&R(i),u&&R(o),c=!1,P(f)}}}function vt(t){let e,n,r,l,i;return{c(){e=F("url: "),n=b("input"),r=b("br"),w(n,"type","text")},m(o,c){I(o,e,c),I(o,n,c),j(n,t[3]),I(o,r,c),l||(i=E(n,"input",t[12]),l=!0)},p(o,c){c&8&&n.value!==o[3]&&j(n,o[3])},d(o){o&&R(e),o&&R(n),o&&R(r),l=!1,i()}}}function Ce(t){let e,n,r,l,i,o,c,f,s=t[7],u=[];for(let a=0;a<s.length;a+=1)u[a]=$e(ve(t,s,a));return{c(){e=F("username: u/"),n=b("input"),r=b("br"),l=F(`\r
                category: \r
                `),i=b("select");for(let a=0;a<u.length;a+=1)u[a].c();o=b("br"),w(n,"type","text"),t[5]===void 0&&ie(()=>t[14].call(i))},m(a,g){I(a,e,g),I(a,n,g),j(n,t[4]),I(a,r,g),I(a,l,g),I(a,i,g);for(let d=0;d<u.length;d+=1)u[d].m(i,null);_e(i,t[5]),I(a,o,g),c||(f=[E(n,"input",t[13]),E(i,"change",t[14])],c=!0)},p(a,g){if(g&16&&n.value!==a[4]&&j(n,a[4]),g&128){s=a[7];let d;for(d=0;d<s.length;d+=1){const p=ve(a,s,d);u[d]?u[d].p(p,g):(u[d]=$e(p),u[d].c(),u[d].m(i,null))}for(;d<u.length;d+=1)u[d].d(1);u.length=s.length}g&160&&_e(i,a[5])},d(a){a&&R(e),a&&R(n),a&&R(r),a&&R(l),a&&R(i),Ie(u,a),a&&R(o),c=!1,P(f)}}}function $e(t){let e,n=t[20]+"",r,l;return{c(){e=b("option"),r=F(n),e.__value=l=t[20],e.value=e.__value},m(i,o){I(i,e,o),_(e,r)},p:M,d(i){i&&R(e)}}}function Ct(t){let e,n,r,l,i,o,c,f,s,u,a,g,d,p,L,h,C,k;function $(y,v){return y[2]==2?vt:kt}let z=$(t),m=z(t);return{c(){e=b("div"),n=b("div"),r=b("button"),r.textContent="user",l=A(),i=b("button"),i.textContent="search",o=A(),c=b("button"),c.textContent="custom",f=A(),s=b("div"),m.c(),u=F(`\r
        count: `),a=b("input"),g=b("br"),d=F(`\r
        nsfw: `),p=b("input"),L=A(),h=b("button"),h.textContent="load",w(n,"class","head"),w(a,"type","number"),w(p,"type","checkbox"),w(s,"class","options"),w(e,"class","redditSearch")},m(y,v){I(y,e,v),_(e,n),_(n,r),_(n,l),_(n,i),_(n,o),_(n,c),_(e,f),_(e,s),m.m(s,null),_(s,u),_(s,a),j(a,t[6].count),_(s,g),_(s,d),_(s,p),p.checked=t[6].nsfw,_(e,L),_(e,h),C||(k=[E(r,"click",t[9]),E(i,"click",t[10]),E(c,"click",t[11]),E(a,"input",t[17]),E(p,"change",t[18]),E(h,"click",t[8])],C=!0)},p(y,[v]){z===(z=$(y))&&m?m.p(y,v):(m.d(1),m=z(y),m&&(m.c(),m.m(s,u))),v&64&&G(a.value)!==y[6].count&&j(a,y[6].count),v&64&&(p.checked=y[6].nsfw)},i:M,o:M,d(y){y&&R(e),m.d(),C=!1,P(k)}}}function Se(t){return t.split(/[ ,;]/).filter(e=>e.trim().length>0)}function $t(t,e,n){let r=0,l="",i="",o="",c="",f=["upvoted","posts"],s,u;function a(){let v="https://www.reddit.com";switch(r){case 0:v+=`/user/${c}/${s}`;break;case 1:v+=`/search/?q=${u.keywords.join(" ")}`;break;case 2:v=l;break}return v}async function g(){var te;let v=a(),S=v.split(/\/\?|\?/);v=`${S[0]}.json${S[1]?"?"+S[1]:""}`,r==1&&n(6,u.keywords=[],u);const D=await wt(v,u);for(let K of D)B.push({url:(te=K==null?void 0:K.url_overridden_by_dest)!=null?te:K==null?void 0:K.url,name:K==null?void 0:K.title})}const d=()=>n(2,r=0),p=()=>n(2,r=1),L=()=>n(2,r=2);function h(){l=this.value,n(3,l)}function C(){c=this.value,n(4,c)}function k(){s=Ge(this),n(5,s),n(7,f)}function $(){o=this.value,n(1,o)}function z(){i=this.value,n(0,i)}function m(){u.count=G(this.value),n(6,u),n(0,i),n(1,o)}function y(){u.nsfw=this.checked,n(6,u),n(0,i),n(1,o)}return t.$$.update=()=>{t.$$.dirty&3&&n(6,u={subreddits:Se(i),keywords:Se(o),nsfw:!0,count:5})},[i,o,r,l,c,s,u,f,g,d,p,L,h,C,k,$,z,m,y]}class St extends Y{constructor(e){super(),X(this,e,$t,Ct,U,{})}}async function De(t){return new Promise((e,n)=>{let r=new Image;r.src=t,r.onload=function(){e(r)},r.onerror=function(l,i){n()}})}async function Rt(t){const e=await De(t);return[e.width,e.height]}async function Et(t,e){const[n,r]=await Rt(e);return{ratio:n/r,items:[t]}}async function It(t,e,n,r,l,i){const o=await De(e),c=o.width/o.height,f=l/i;let s=c>f?f/c*o.width:o.width,u=c>f?o.height:c/f*o.height,a=(o.width-s)/2,g=(o.height-u)/2;t.drawImage(o,a,g,s,u,n,r,l,i)}function Lt(t,e,n){const r=t/e;return r>n?t*=n/r:e*=r/n,[t,e]}function jt(t,e,n,r,l,i,o=0){console.log(n,r,l,i);let[c,f]=Lt(l,i,e.ratio);return fe(t,e,n,r,c+o,f+o,o),[c,f]}async function fe(t,e,n,r,l,i,o=0){if(e.horizontal==null||typeof e.items[0]=="number"){let f=e.items[0];if(f<0)return;const s=await B.getLink(f);It(t,s,n,r,l-o,i-o);return}let c=0;if(e.horizontal==!0)for(let f of e.items){let s=f.ratio/e.ratio*l;await fe(t,f,n+c,r,s,i,o),c+=s}else for(let f of e.items){let s=e.ratio/f.ratio*i;await fe(t,f,n,r+c,l,s,o),c+=s}}async function At(t){let e=B.get();const n=[];for(let m=0;m<e.length;m++){let y=e[m];n.push(Et(m,y.url))}let i=(await Promise.allSettled(n)).filter(m=>m.status=="fulfilled").map(m=>m.value);const o=i.length;i=[...i].sort((m,y)=>m.ratio-y.ratio);let c=i.reduce((m,y)=>m+y.ratio,0);const f=c/o;c=i.reduce((m,y)=>m+Math.sqrt(f/y.ratio)*y.ratio,0);const s=Math.round(Math.sqrt(c/t)),u=c/s;let a=[],g=0,d=0,p=0;for(let m=0;m<i.length;m++){const y=g/p;let v=u*Math.sqrt(y/f)-g;if(v<0){let S=d<-v;a.push(S?m-1:m),g=S?i[m-1].ratio:0,p=0}g+=i[m].ratio,p++,d=v}let L=0,h=[];a.push(i.length);for(let m of a){const y=i.slice(L,m),S=y.map(D=>D.ratio).reduce((D,te)=>D+te,0);h.push({ratio:S,horizontal:!0,items:[...y]}),L=m}const C=h.map(m=>m.ratio),$={ratio:1/C.reduce((m,y)=>m+1/y,0),horizontal:!1,items:[...h]};function z(m){return m.items.reduce((v,S)=>v+S.items[0],0)/m.items.length}$.items.sort((m,y)=>z(m)-z(y));for(let m of $.items)m.items.sort((y,v)=>y.items[0]-v.items[0]);return $}function Mt(t){let e,n,r,l,i,o,c,f,s,u,a,g,d,p,L,h,C,k,$,z,m,y,v;return{c(){e=b("div"),n=b("div"),r=F("1280x720, 1920\xD71080, 2560\xD71440, 3200\xD71800, 3840\xD72160"),l=b("br"),i=F(`\r
        width: `),o=b("input"),c=F(`\r
        height: `),f=b("input"),s=F(`\r
        margin: `),u=b("input"),a=F(`\r
        border: `),g=b("input"),d=F(`\r
        background: `),p=b("input"),L=A(),h=b("button"),h.textContent="generate",C=A(),k=b("div"),$=b("canvas"),z=A(),m=b("button"),m.textContent="snapshot",w(o,"type","number"),w(f,"type","number"),w(u,"type","number"),w(g,"type","number"),w(p,"type","color"),w(n,"class","settings"),w($,"height",t[2]),w($,"width",t[1]),w($,"class","svelte-1ryfd5b"),w(k,"class","display"),w(e,"class","collagesContainer svelte-1ryfd5b")},m(S,D){I(S,e,D),_(e,n),_(n,r),_(n,l),_(n,i),_(n,o),j(o,t[1]),_(n,c),_(n,f),j(f,t[2]),_(n,s),_(n,u),j(u,t[3]),_(n,a),_(n,g),j(g,t[4]),_(n,d),_(n,p),j(p,t[5]),_(n,L),_(n,h),_(e,C),_(e,k),_(k,$),t[13]($),_(e,z),_(e,m),y||(v=[E(o,"input",t[8]),E(f,"input",t[9]),E(u,"input",t[10]),E(g,"input",t[11]),E(p,"input",t[12]),E(h,"click",t[6]),E(m,"click",t[7])],y=!0)},p(S,[D]){D&2&&G(o.value)!==S[1]&&j(o,S[1]),D&4&&G(f.value)!==S[2]&&j(f,S[2]),D&8&&G(u.value)!==S[3]&&j(u,S[3]),D&16&&G(g.value)!==S[4]&&j(g,S[4]),D&32&&j(p,S[5]),D&4&&w($,"height",S[2]),D&2&&w($,"width",S[1])},i:M,o:M,d(S){S&&R(e),t[13](null),y=!1,P(v)}}}function zt(t,e,n){let r,l;We(()=>{l=r.getContext("2d"),l.imageSmoothingEnabled=!0,l.imageSmoothingQuality="high"});let i=1280,o=720,c=5,f=10,s="#F5DEB3",u=[i,o];async function a(){n(0,r.width=i,r),n(0,r.height=o,r),l.fillStyle=s,l.clearRect(0,0,i,o),l.fillRect(0,0,i,o);const $=await At(i/o),[z,m]=jt(l,$,f,f,i-f*2,o-f*2,c);u=[z+f*2,m+f*2]}async function g(){const[$,z]=u,m=await createImageBitmap(r);n(0,r.width=$,r),n(0,r.height=z,r),l.drawImage(m,0,0);const y=r.toDataURL();let v=document.createElement("a");v.href=y,v.download="collage.png",v.click()}function d(){i=G(this.value),n(1,i)}function p(){o=G(this.value),n(2,o)}function L(){c=G(this.value),n(3,c)}function h(){f=G(this.value),n(4,f)}function C(){s=this.value,n(5,s)}function k($){ce[$?"unshift":"push"](()=>{r=$,n(0,r)})}return[r,i,o,c,f,s,a,g,d,p,L,h,C,k]}class Dt extends Y{constructor(e){super(),X(this,e,zt,Mt,U,{})}}function Ft(t){let e,n,r,l,i,o,c,f,s,u,a,g,d,p,L;return l=new St({}),o=new yt({}),u=new ht({}),p=new Dt({}),{c(){e=b("main"),n=b("h1"),n.textContent="1. Choose images",r=A(),Z(l.$$.fragment),i=A(),Z(o.$$.fragment),c=A(),f=b("h1"),f.textContent="2. Manage images",s=A(),Z(u.$$.fragment),a=A(),g=b("h1"),g.textContent="3. Generate Collage",d=A(),Z(p.$$.fragment),w(n,"class","svelte-enb3qt"),w(f,"class","svelte-enb3qt"),w(g,"class","svelte-enb3qt"),w(e,"class","svelte-enb3qt")},m(h,C){I(h,e,C),_(e,n),_(e,r),Q(l,e,null),_(e,i),Q(o,e,null),_(e,c),_(e,f),_(e,s),Q(u,e,null),_(e,a),_(e,g),_(e,d),Q(p,e,null),L=!0},p:M,i(h){L||(W(l.$$.fragment,h),W(o.$$.fragment,h),W(u.$$.fragment,h),W(p.$$.fragment,h),L=!0)},o(h){T(l.$$.fragment,h),T(o.$$.fragment,h),T(u.$$.fragment,h),T(p.$$.fragment,h),L=!1},d(h){h&&R(e),V(l),V(o),V(u),V(p)}}}class Ot extends Y{constructor(e){super(),X(this,e,null,Ft,U,{})}}new Ot({target:document.body});

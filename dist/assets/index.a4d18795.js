(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))l(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&l(r)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerpolicy&&(i.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?i.credentials="include":o.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function l(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();function F(){}function Ge(e){return e()}function pe(){return Object.create(null)}function R(e){e.forEach(Ge)}function Re(e){return typeof e=="function"}function H(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}let ne;function me(e,t){return ne||(ne=document.createElement("a")),ne.href=t,e===ne.href}function Be(e){return Object.keys(e).length===0}function Se(e,...t){if(e==null)return F;const n=e.subscribe(...t);return n.unsubscribe?()=>n.unsubscribe():n}function he(e){let t;return Se(e,n=>t=n)(),t}function Ne(e,t,n){e.$$.on_destroy.push(Se(t,n))}function b(e,t){e.appendChild(t)}function S(e,t,n){e.insertBefore(t,n||null)}function Y(e){e.parentNode.removeChild(e)}function Ie(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function _(e){return document.createElement(e)}function K(e){return document.createTextNode(e)}function j(){return K(" ")}function G(e,t,n,l){return e.addEventListener(t,n,l),()=>e.removeEventListener(t,n,l)}function w(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function N(e){return e===""?null:+e}function Ue(e){return Array.from(e.childNodes)}function z(e,t){e.value=t==null?"":t}function be(e,t){for(let n=0;n<e.options.length;n+=1){const l=e.options[n];if(l.__value===t){l.selected=!0;return}}e.selectedIndex=-1}function Pe(e){const t=e.querySelector(":checked")||e.options[0];return t&&t.__value}function ge(e,t,n){e.classList[n?"add":"remove"](t)}let ee;function x(e){ee=e}function Ee(){if(!ee)throw new Error("Function called outside component initialization");return ee}function Qe(e){Ee().$$.on_mount.push(e)}function Te(e,t){const n=e.$$.callbacks[t.type];n&&n.slice().forEach(l=>l.call(this,t))}const D=[],ce=[],oe=[],_e=[],He=Promise.resolve();let ae=!1;function $e(){ae||(ae=!0,He.then(ze))}function ie(e){oe.push(e)}const se=new Set;let le=0;function ze(){const e=ee;do{for(;le<D.length;){const t=D[le];le++,x(t),Me(t.$$)}for(x(null),D.length=0,le=0;ce.length;)ce.pop()();for(let t=0;t<oe.length;t+=1){const n=oe[t];se.has(n)||(se.add(n),n())}oe.length=0}while(D.length);for(;_e.length;)_e.pop()();ae=!1,se.clear(),x(e)}function Me(e){if(e.fragment!==null){e.update(),R(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(ie)}}const re=new Set;let Q;function Oe(){Q={r:0,c:[],p:Q}}function Ae(){Q.r||R(Q.c),Q=Q.p}function P(e,t){e&&e.i&&(re.delete(e),e.i(t))}function T(e,t,n,l){if(e&&e.o){if(re.has(e))return;re.add(e),Q.c.push(()=>{re.delete(e),l&&(n&&e.d(1),l())}),e.o(t)}}function q(e){e&&e.c()}function M(e,t,n,l){const{fragment:o,on_mount:i,on_destroy:r,after_update:c}=e.$$;o&&o.m(t,n),l||ie(()=>{const f=i.map(Ge).filter(Re);r?r.push(...f):R(f),e.$$.on_mount=[]}),c.forEach(ie)}function O(e,t){const n=e.$$;n.fragment!==null&&(R(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function Je(e,t){e.$$.dirty[0]===-1&&(D.push(e),$e(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function A(e,t,n,l,o,i,r,c=[-1]){const f=ee;x(e);const s=e.$$={fragment:null,ctx:null,props:i,update:F,not_equal:o,bound:pe(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(f?f.$$.context:[])),callbacks:pe(),dirty:c,skip_bound:!1,root:t.target||f.$$.root};r&&r(s.root);let u=!1;if(s.ctx=n?n(e,t.props||{},(a,g,...d)=>{const p=d.length?d[0]:g;return s.ctx&&o(s.ctx[a],s.ctx[a]=p)&&(!s.skip_bound&&s.bound[a]&&s.bound[a](p),u&&Je(e,a)),g}):[],s.update(),u=!0,R(s.before_update),s.fragment=l?l(s.ctx):!1,t.target){if(t.hydrate){const a=Ue(t.target);s.fragment&&s.fragment.l(a),a.forEach(Y)}else s.fragment&&s.fragment.c();t.intro&&P(e.$$.fragment),M(e,t.target,t.anchor,t.customElement),ze()}x(f)}class J{$destroy(){O(this,1),this.$destroy=F}$on(t,n){const l=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return l.push(n),()=>{const o=l.indexOf(n);o!==-1&&l.splice(o,1)}}$set(t){this.$$set&&!Be(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const $=[];function De(e,t=F){let n;const l=new Set;function o(c){if(H(e,c)&&(e=c,n)){const f=!$.length;for(const s of l)s[1](),$.push(s,e);if(f){for(let s=0;s<$.length;s+=2)$[s][0]($[s+1]);$.length=0}}}function i(c){o(c(e))}function r(c,f=F){const s=[c,f];return l.add(s),l.size===1&&(n=t(o)||F),c(e),()=>{l.delete(s),l.size===0&&(n(),n=null)}}return{set:o,update:i,subscribe:r}}function X(e){return new Promise((t,n)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>n(e.error)})}function je(e,t){const n=indexedDB.open(e);n.onupgradeneeded=()=>n.result.createObjectStore(t);const l=X(n);return(o,i)=>l.then(r=>i(r.transaction(t,o).objectStore(t)))}let ue;function B(){return ue||(ue=je("keyval-store","keyval")),ue}function Fe(e,t=B()){return t("readonly",n=>X(n.get(e)))}function Le(e,t,n=B()){return n("readwrite",l=>(l.put(t,e),X(l.transaction)))}function qe(e,t=B()){return t("readwrite",n=>(e.forEach(l=>n.put(l[1],l[0])),X(n.transaction)))}function xe(e,t=B()){return t("readonly",n=>Promise.all(e.map(l=>X(n.get(l)))))}function et(e,t,n=B()){return n("readwrite",l=>new Promise((o,i)=>{l.get(e).onsuccess=function(){try{l.put(t(this.result),e),o(X(l.transaction))}catch(r){i(r)}}}))}function Ve(e,t=B()){return t("readwrite",n=>(n.delete(e),X(n.transaction)))}function tt(e,t=B()){return t("readwrite",n=>(e.forEach(l=>n.delete(l)),X(n.transaction)))}function nt(e=B()){return e("readwrite",t=>(t.clear(),X(t.transaction)))}function de(e,t){return e.openCursor().onsuccess=function(){!this.result||(t(this.result),this.result.continue())},X(e.transaction)}function lt(e=B()){return e("readonly",t=>{if(t.getAllKeys)return X(t.getAllKeys());const n=[];return de(t,l=>n.push(l.key)).then(()=>n)})}function ot(e=B()){return e("readonly",t=>{if(t.getAll)return X(t.getAll());const n=[];return de(t,l=>n.push(l.value)).then(()=>n)})}function rt(e=B()){return e("readonly",t=>{if(t.getAll&&t.getAllKeys)return Promise.all([X(t.getAllKeys()),X(t.getAll())]).then(([l,o])=>l.map((i,r)=>[i,o[r]]));const n=[];return e("readonly",l=>de(l,o=>n.push([o.key,o.value])).then(()=>n))})}const it=Object.freeze(Object.defineProperty({__proto__:null,clear:nt,createStore:je,del:Ve,delMany:tt,entries:rt,get:Fe,getMany:xe,keys:lt,promisifyRequest:X,set:Le,setMany:qe,update:et,values:ot},Symbol.toStringTag,{value:"Module"})),{get:st,set:ut}=it,ct=(e,t)=>{const n=De(t);return typeof indexedDB>"u"||((async()=>{const l=await st(e);l!=null&&n.set(l)})(),n.subscribe(l=>{ut(e,l)})),n};function at(e){return new Promise(t=>{const n=new FileReader;n.readAsDataURL(e),n.onload=async()=>{typeof n.result=="string"&&t(n.result)}})}const E=ft();function ft(){const{subscribe:e,update:t,set:n}=ct("chosen-images",[]);return{subscribe:e,push:(...l)=>{t(o=>[...o,...l])},delete:(...l)=>{t(o=>{var i;for(let r of l)(i=o[r])!=null&&i.FullResKey&&Ve(o[r].FullResKey),o[r]=null;return o.filter(r=>r)})},get:()=>he(E),getLink:async l=>{const o=he(E)[l];if(o.FullResKey){const i=await Fe(o.FullResKey);return await at(i)}return o.url}}}function dt(e){let t,n,l,o,i;return{c(){t=_("img"),me(t.src,n=e[0].url)||w(t,"src",n),w(t,"alt",l=e[0].name),w(t,"class","svelte-9h94g7"),ge(t,"selected",e[1])},m(r,c){S(r,t,c),o||(i=G(t,"click",e[2]),o=!0)},p(r,[c]){c&1&&!me(t.src,n=r[0].url)&&w(t,"src",n),c&1&&l!==(l=r[0].name)&&w(t,"alt",l),c&2&&ge(t,"selected",r[1])},i:F,o:F,d(r){r&&Y(t),o=!1,i()}}}function pt(e,t,n){let{data:l}=t,{selected:o}=t;function i(r){Te.call(this,e,r)}return e.$$set=r=>{"data"in r&&n(0,l=r.data),"selected"in r&&n(1,o=r.selected)},[l,o,i]}class mt extends J{constructor(t){super(),A(this,t,pt,dt,H,{data:0,selected:1})}}function ye(e,t,n){const l=e.slice();return l[6]=t[n],l[8]=n,l}function we(e){let t,n;function l(){return e[5](e[8])}return t=new mt({props:{data:e[6],selected:e[0][e[8]]}}),t.$on("click",l),{c(){q(t.$$.fragment)},m(o,i){M(t,o,i),n=!0},p(o,i){e=o;const r={};i&2&&(r.data=e[6]),i&1&&(r.selected=e[0][e[8]]),t.$set(r)},i(o){n||(P(t.$$.fragment,o),n=!0)},o(o){T(t.$$.fragment,o),n=!1},d(o){O(t,o)}}}function ht(e){let t,n,l,o,i,r,c,f,s,u,a,g,d=e[1],p=[];for(let h=0;h<d.length;h+=1)p[h]=we(ye(e,d,h));const I=h=>T(p[h],1,1,()=>{p[h]=null});return{c(){t=_("div"),n=_("div"),l=_("button"),l.textContent="delete",o=j(),i=_("button"),i.textContent="unselect",r=j(),c=_("button"),c.textContent="invert selection",f=j(),s=_("div");for(let h=0;h<p.length;h+=1)p[h].c();w(n,"class","header"),w(s,"class","content svelte-115ye2s"),w(t,"class","gallery")},m(h,W){S(h,t,W),b(t,n),b(n,l),b(n,o),b(n,i),b(n,r),b(n,c),b(t,f),b(t,s);for(let k=0;k<p.length;k+=1)p[k].m(s,null);u=!0,a||(g=[G(l,"click",e[2]),G(i,"click",e[4]),G(c,"click",e[3])],a=!0)},p(h,[W]){if(W&3){d=h[1];let k;for(k=0;k<d.length;k+=1){const C=ye(h,d,k);p[k]?(p[k].p(C,W),P(p[k],1)):(p[k]=we(C),p[k].c(),P(p[k],1),p[k].m(s,null))}for(Oe(),k=d.length;k<p.length;k+=1)I(k);Ae()}},i(h){if(!u){for(let W=0;W<d.length;W+=1)P(p[W]);u=!0}},o(h){p=p.filter(Boolean);for(let W=0;W<p.length;W+=1)T(p[W]);u=!1},d(h){h&&Y(t),Ie(p,h),a=!1,R(g)}}}function bt(e,t,n){let l;Ne(e,E,s=>n(1,l=s));let o={};function i(){const s=Object.entries(o).filter(u=>u[1]).map(u=>Number(u[0]));E.delete(...s),n(0,o={})}function r(){n(0,o=Object.fromEntries(l.map((s,u)=>[u,!o[u]])))}return[o,l,i,r,()=>n(0,o={}),s=>n(0,o[s]=!o[s],o)]}class gt extends J{constructor(t){super(),A(this,t,bt,ht,H,{})}}const Ke="KGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIHIodCl7cmV0dXJuIG5ldyBQcm9taXNlKGE9Pntjb25zdCBlPW5ldyBGaWxlUmVhZGVyO2UucmVhZEFzRGF0YVVSTCh0KSxlLm9ubG9hZD1hc3luYygpPT57dHlwZW9mIGUucmVzdWx0PT0ic3RyaW5nIiYmYShlLnJlc3VsdCl9fSl9c2VsZi5hZGRFdmVudExpc3RlbmVyKCJtZXNzYWdlIixhc3luYyB0PT57Y29uc3QgYT10LmRhdGE7c3dpdGNoKGEudHlwZSl7Y2FzZSJwcm9jZXNzIjpjb25zdCBlPWF3YWl0IGwoYS5kYXRhKTtzZWxmLnBvc3RNZXNzYWdlKHt0eXBlOiJwcm9jZXNzIixkYXRhOmV9KTticmVhaztjYXNlInByb2Nlc3NfYmF0Y2giOmNvbnN0IG49YS5kYXRhO2ZvciBhd2FpdChsZXQgcyBvZiBuKXtjb25zdCBvPWF3YWl0IGwocyk7c2VsZi5wb3N0TWVzc2FnZSh7dHlwZToicHJvY2VzcyIsZGF0YTpvfSl9YnJlYWs7ZGVmYXVsdDpjb25zb2xlLmxvZygidW5kZWZpbmVkIGNvbW1hbmQiKTticmVha319KTthc3luYyBmdW5jdGlvbiBsKHQpe2xldCBhPXtuYW1lOnQubmFtZSx0aHVtYm5haWw6bnVsbH07Y29uc3QgZT0zMDAqMzAwLG49MTVlNCxzPTVlNixvPWF3YWl0IHIodCk7aWYoY29uc29sZS5sb2codC5zaXplKSx0LnNpemU+cyl7Y29uc29sZS5sb2coIjEiKTtjb25zdCBjPWF3YWl0IHUodCk7bGV0IGk9YXdhaXQgbShjKTtpZihpLnNpemU+cyl7Y29uc29sZS5sb2coIjEuMSIpO2NvbnN0IGg9MS8yKipNYXRoLmNlaWwoTWF0aC5sb2cyKGkuc2l6ZS9zKSk7bGV0IGY9YXdhaXQgdyhjLGgpO2k9YXdhaXQgZChmLCJpbWFnZS9qcGVnIil9YS50aHVtYm5haWw9YXdhaXQgZyhjLGUpLGEubGFyZ2VTaXplPWl9ZWxzZSBpZih0LnNpemU+bil7Y29uc29sZS5sb2coIjIiKTtjb25zdCBjPWF3YWl0IHUodCk7YS50aHVtYm5haWw9YXdhaXQgZyhjLGUpLGEubGFyZ2VTaXplPXR9ZWxzZSBjb25zb2xlLmxvZygiMyIpLGEudGh1bWJuYWlsPW87cmV0dXJuIGF9YXN5bmMgZnVuY3Rpb24gbSh0KXtjb25zdCBhPW5ldyBPZmZzY3JlZW5DYW52YXModC53aWR0aCx0LmhlaWdodCk7cmV0dXJuIGEuZ2V0Q29udGV4dCgiMmQiKS5kcmF3SW1hZ2UodCwwLDApLGF3YWl0IGEuY29udmVydFRvQmxvYih7dHlwZToiaW1hZ2UvanBlZyJ9KX1hc3luYyBmdW5jdGlvbiBkKHQsYT0iaW1hZ2UvanBlZyIpe3JldHVybiBhd2FpdCB0LmNvbnZlcnRUb0Jsb2Ioe3R5cGU6YX0pfWFzeW5jIGZ1bmN0aW9uIGcodCxhKXtjb25zdCBlPXQud2lkdGgqdC5oZWlnaHQsbj1NYXRoLnNxcnQoYS9lKSxvPWF3YWl0KGF3YWl0IHcodCxuKSkuY29udmVydFRvQmxvYigpO3JldHVybiBhd2FpdCByKG8pfWFzeW5jIGZ1bmN0aW9uIHcodCxhKXtjb25zdCBlPU1hdGgucm91bmQodC53aWR0aCphKSxuPU1hdGgucm91bmQodC5oZWlnaHQqYSkscz1uZXcgT2Zmc2NyZWVuQ2FudmFzKGUsbik7cmV0dXJuIHMuZ2V0Q29udGV4dCgiMmQiKS5kcmF3SW1hZ2UodCwwLDAsZSxuKSxzfWFzeW5jIGZ1bmN0aW9uIHUodCl7cmV0dXJuIGF3YWl0IGNyZWF0ZUltYWdlQml0bWFwKHQpfX0pKCk7Cg==",ke=typeof window<"u"&&window.Blob&&new Blob([atob(Ke)],{type:"text/javascript;charset=utf-8"});function _t(){const e=ke&&(window.URL||window.webkitURL).createObjectURL(ke);try{return e?new Worker(e):new Worker("data:application/javascript;base64,"+Ke)}finally{e&&(window.URL||window.webkitURL).revokeObjectURL(e)}}function yt(e){let t,n,l,o,i;return{c(){t=_("input"),n=j(),l=_("button"),l.textContent="stop upload",w(t,"type","file"),t.multiple=!0,w(t,"accept","image/*")},m(r,c){S(r,t,c),S(r,n,c),S(r,l,c),o||(i=[G(t,"change",e[0]),G(l,"click",e[1])],o=!0)},p:F,i:F,o:F,d(r){r&&Y(t),r&&Y(n),r&&Y(l),o=!1,R(i)}}}function wt(e){let t;const n=async s=>{const u=s.target,{files:a}=u;i(),o({type:"process_batch",data:[...a]})},l=s=>{const u={name:s.name,url:s.thumbnail};s.largeSize&&(u.FullResKey=f(s.largeSize)),E.push(u)},o=s=>{typeof Worker>"u"||!t||t.postMessage(s)},i=()=>{typeof Worker>"u"||t||(t=new _t,t.onmessage=c)},r=()=>{console.log("closing worker"),t&&t.terminate(),t=void 0},c=s=>{const u=s.data;switch(u.type){case"process":l(u.data);break;default:console.log("undefined message type");break}};function f(s){const u=Date.now().toString();return Le(u,s),u}return[n,r]}class kt extends J{constructor(t){super(),A(this,t,wt,yt,H,{})}}async function vt(e,t){let{subreddits:n,keywords:l,nsfw:o,count:i=10}=t;n.length==0&&(n=[""]),l.length==0&&(l=[""]),e+=e.includes("?")?"&":"?";const r=e+"include_over_18="+(o?"on":"off");n=n.map(d=>d.toLowerCase()),l=l.map(d=>d.toLowerCase());const c=Math.min(i,100),f=[];let s=await ve(`${r}&limit=${c}`),u=s.children;const a=d=>{let p=d.data;return n.some(I=>p.subreddit.toLowerCase().includes(I))||l.some(I=>p.title.toLowerCase().includes(I))};for(let d=0;d<u.length;d++)a(u[d])&&f.push(u[d].data);let g=u.length;for(;(s==null?void 0:s.after)&&g<i;){s=await ve(e+"&after="+s.after),u=s.children;for(let d=0;d<u.length;d++)a(u[d])&&f.push(u[d].data);g+=u.length}return f}async function ve(e){try{console.log("fetch",e);const t=await fetch(e);return t.status==403&&console.log("forbidden, don't forget to sign into reddit"),console.log(t),(await t.json()).data}catch(t){console.log(t)}}function We(e,t,n){const l=e.slice();return l[20]=t[n],l}function Wt(e){let t,n,l,o,i,r,c,f,s=e[2]==0&&Ce(e);return{c(){s&&s.c(),t=K(`\r
            search: `),n=_("input"),l=_("br"),o=K(`\r
            subreddits: `),i=_("input"),r=_("br"),w(n,"type","text"),w(n,"placeholder",'keywords split by " ,;"'),w(i,"type","text"),w(i,"placeholder",'keywords split by " ,;"')},m(u,a){s&&s.m(u,a),S(u,t,a),S(u,n,a),z(n,e[1]),S(u,l,a),S(u,o,a),S(u,i,a),z(i,e[0]),S(u,r,a),c||(f=[G(n,"input",e[15]),G(i,"input",e[16])],c=!0)},p(u,a){u[2]==0?s?s.p(u,a):(s=Ce(u),s.c(),s.m(t.parentNode,t)):s&&(s.d(1),s=null),a&2&&n.value!==u[1]&&z(n,u[1]),a&1&&i.value!==u[0]&&z(i,u[0])},d(u){s&&s.d(u),u&&Y(t),u&&Y(n),u&&Y(l),u&&Y(o),u&&Y(i),u&&Y(r),c=!1,R(f)}}}function Ct(e){let t,n,l,o,i;return{c(){t=K("url: "),n=_("input"),l=_("br"),w(n,"type","text")},m(r,c){S(r,t,c),S(r,n,c),z(n,e[3]),S(r,l,c),o||(i=G(n,"input",e[12]),o=!0)},p(r,c){c&8&&n.value!==r[3]&&z(n,r[3])},d(r){r&&Y(t),r&&Y(n),r&&Y(l),o=!1,i()}}}function Ce(e){let t,n,l,o,i,r,c,f,s=e[7],u=[];for(let a=0;a<s.length;a+=1)u[a]=Ze(We(e,s,a));return{c(){t=K("username: u/"),n=_("input"),l=_("br"),o=K(`\r
                category: \r
                `),i=_("select");for(let a=0;a<u.length;a+=1)u[a].c();r=_("br"),w(n,"type","text"),e[5]===void 0&&ie(()=>e[14].call(i))},m(a,g){S(a,t,g),S(a,n,g),z(n,e[4]),S(a,l,g),S(a,o,g),S(a,i,g);for(let d=0;d<u.length;d+=1)u[d].m(i,null);be(i,e[5]),S(a,r,g),c||(f=[G(n,"input",e[13]),G(i,"change",e[14])],c=!0)},p(a,g){if(g&16&&n.value!==a[4]&&z(n,a[4]),g&128){s=a[7];let d;for(d=0;d<s.length;d+=1){const p=We(a,s,d);u[d]?u[d].p(p,g):(u[d]=Ze(p),u[d].c(),u[d].m(i,null))}for(;d<u.length;d+=1)u[d].d(1);u.length=s.length}g&160&&be(i,a[5])},d(a){a&&Y(t),a&&Y(n),a&&Y(l),a&&Y(o),a&&Y(i),Ie(u,a),a&&Y(r),c=!1,R(f)}}}function Ze(e){let t,n=e[20]+"",l,o;return{c(){t=_("option"),l=K(n),t.__value=o=e[20],t.value=t.__value},m(i,r){S(i,t,r),b(t,l)},p:F,d(i){i&&Y(t)}}}function Zt(e){let t,n,l,o,i,r,c,f,s,u,a,g,d,p,I,h,W,k;function C(y,v){return y[2]==2?Ct:Wt}let L=C(e),m=L(e);return{c(){t=_("div"),n=_("div"),l=_("button"),l.textContent="user",o=j(),i=_("button"),i.textContent="search",r=j(),c=_("button"),c.textContent="custom",f=j(),s=_("div"),m.c(),u=K(`\r
        count: `),a=_("input"),g=_("br"),d=K(`\r
        nsfw: `),p=_("input"),I=j(),h=_("button"),h.textContent="load",w(n,"class","head"),w(a,"type","number"),w(p,"type","checkbox"),w(s,"class","options"),w(t,"class","redditSearch")},m(y,v){S(y,t,v),b(t,n),b(n,l),b(n,o),b(n,i),b(n,r),b(n,c),b(t,f),b(t,s),m.m(s,null),b(s,u),b(s,a),z(a,e[6].count),b(s,g),b(s,d),b(s,p),p.checked=e[6].nsfw,b(t,I),b(t,h),W||(k=[G(l,"click",e[9]),G(i,"click",e[10]),G(c,"click",e[11]),G(a,"input",e[17]),G(p,"change",e[18]),G(h,"click",e[8])],W=!0)},p(y,[v]){L===(L=C(y))&&m?m.p(y,v):(m.d(1),m=L(y),m&&(m.c(),m.m(s,u))),v&64&&N(a.value)!==y[6].count&&z(a,y[6].count),v&64&&(p.checked=y[6].nsfw)},i:F,o:F,d(y){y&&Y(t),m.d(),W=!1,R(k)}}}function Ye(e){return e.split(/[ ,;]/).filter(t=>t.trim().length>0)}function Yt(e,t,n){let l=0,o="",i="",r="",c="",f=["upvoted","posts"],s,u;function a(){let v="https://www.reddit.com";switch(l){case 0:v+=`/user/${c}/${s}`;break;case 1:v+=`/search/?q=${u.keywords.join(" ")}`;break;case 2:v=o;break}return v}async function g(){var te;let v=a(),Z=v.split(/\/\?|\?/);v=`${Z[0]}.json${Z[1]?"?"+Z[1]:""}`,l==1&&n(6,u.keywords=[],u);const V=await vt(v,u);for(let U of V)E.push({url:(te=U==null?void 0:U.url_overridden_by_dest)!=null?te:U==null?void 0:U.url,name:U==null?void 0:U.title})}const d=()=>n(2,l=0),p=()=>n(2,l=1),I=()=>n(2,l=2);function h(){o=this.value,n(3,o)}function W(){c=this.value,n(4,c)}function k(){s=Pe(this),n(5,s),n(7,f)}function C(){r=this.value,n(1,r)}function L(){i=this.value,n(0,i)}function m(){u.count=N(this.value),n(6,u),n(0,i),n(1,r)}function y(){u.nsfw=this.checked,n(6,u),n(0,i),n(1,r)}return e.$$.update=()=>{e.$$.dirty&3&&n(6,u={subreddits:Ye(i),keywords:Ye(r),nsfw:!0,count:5})},[i,r,l,o,c,s,u,f,g,d,p,I,h,W,k,C,L,m,y]}class Gt extends J{constructor(t){super(),A(this,t,Yt,Zt,H,{})}}async function Xe(e){return new Promise((t,n)=>{let l=new Image;l.src=e,l.onload=function(){t(l)},l.onerror=function(o,i){n()}})}async function St(e){const t=await Xe(e);return[t.width,t.height]}async function It(e,t){const[n,l]=await St(t);return{ratio:n/l,items:[e]}}async function zt(e,t,n,l,o,i){const r=await Xe(t),c=r.width/r.height,f=o/i;let s=c>f?f/c*r.width:r.width,u=c>f?r.height:c/f*r.height,a=(r.width-s)/2,g=(r.height-u)/2;e.drawImage(r,a,g,s,u,n,l,o,i)}function jt(e,t,n){const l=e/t;return l>n?e*=n/l:t*=l/n,[e,t]}function Ft(e,t,n,l,o,i,r=0){console.log(n,l,o,i);let[c,f]=jt(o,i,t.ratio);return fe(e,t,n,l,c+r,f+r,r),[c,f]}async function fe(e,t,n,l,o,i,r=0){if(t.horizontal==null||typeof t.items[0]=="number"){let f=t.items[0];if(f<0)return;const s=await E.getLink(f);zt(e,s,n,l,o-r,i-r);return}let c=0;if(t.horizontal==!0)for(let f of t.items){let s=f.ratio/t.ratio*o;await fe(e,f,n+c,l,s,i,r),c+=s}else for(let f of t.items){let s=t.ratio/f.ratio*i;await fe(e,f,n,l+c,o,s,r),c+=s}}async function Lt(e){let t=E.get();const n=[];for(let m=0;m<t.length;m++){let y=t[m];n.push(It(m,y.url))}let i=(await Promise.allSettled(n)).filter(m=>m.status=="fulfilled").map(m=>m.value);const r=i.length;i=[...i].sort((m,y)=>m.ratio-y.ratio);let c=i.reduce((m,y)=>m+y.ratio,0);const f=c/r;c=i.reduce((m,y)=>m+Math.sqrt(f/y.ratio)*y.ratio,0);const s=Math.round(Math.sqrt(c/e)),u=c/s;let a=[],g=0,d=0,p=0;for(let m=0;m<i.length;m++){const y=g/p;let v=u*Math.sqrt(y/f)-g;if(v<0){let Z=d<-v;a.push(Z?m-1:m),g=Z?i[m-1].ratio:0,p=0}g+=i[m].ratio,p++,d=v}let I=0,h=[];a.push(i.length);for(let m of a){const y=i.slice(I,m),Z=y.map(V=>V.ratio).reduce((V,te)=>V+te,0);h.push({ratio:Z,horizontal:!0,items:[...y]}),I=m}const W=h.map(m=>m.ratio),C={ratio:1/W.reduce((m,y)=>m+1/y,0),horizontal:!1,items:[...h]};function L(m){return m.items.reduce((v,Z)=>v+Z.items[0],0)/m.items.length}C.items.sort((m,y)=>L(m)-L(y));for(let m of C.items)m.items.sort((y,v)=>y.items[0]-v.items[0]);return C}function Vt(e){let t,n,l,o,i,r,c,f,s,u,a,g,d,p,I,h,W,k,C,L,m,y,v;return{c(){t=_("div"),n=_("div"),l=K("1280x720, 1920\xD71080, 2560\xD71440, 3200\xD71800, 3840\xD72160"),o=_("br"),i=K(`\r
        width: `),r=_("input"),c=K(`\r
        height: `),f=_("input"),s=K(`\r
        margin: `),u=_("input"),a=K(`\r
        border: `),g=_("input"),d=K(`\r
        background: `),p=_("input"),I=j(),h=_("button"),h.textContent="generate",W=j(),k=_("div"),C=_("canvas"),L=j(),m=_("button"),m.textContent="snapshot",w(r,"type","number"),w(f,"type","number"),w(u,"type","number"),w(g,"type","number"),w(p,"type","color"),w(n,"class","settings"),w(C,"height",e[2]),w(C,"width",e[1]),w(C,"class","svelte-1ryfd5b"),w(k,"class","display"),w(t,"class","collagesContainer svelte-1ryfd5b")},m(Z,V){S(Z,t,V),b(t,n),b(n,l),b(n,o),b(n,i),b(n,r),z(r,e[1]),b(n,c),b(n,f),z(f,e[2]),b(n,s),b(n,u),z(u,e[3]),b(n,a),b(n,g),z(g,e[4]),b(n,d),b(n,p),z(p,e[5]),b(n,I),b(n,h),b(t,W),b(t,k),b(k,C),e[13](C),b(t,L),b(t,m),y||(v=[G(r,"input",e[8]),G(f,"input",e[9]),G(u,"input",e[10]),G(g,"input",e[11]),G(p,"input",e[12]),G(h,"click",e[6]),G(m,"click",e[7])],y=!0)},p(Z,[V]){V&2&&N(r.value)!==Z[1]&&z(r,Z[1]),V&4&&N(f.value)!==Z[2]&&z(f,Z[2]),V&8&&N(u.value)!==Z[3]&&z(u,Z[3]),V&16&&N(g.value)!==Z[4]&&z(g,Z[4]),V&32&&z(p,Z[5]),V&4&&w(C,"height",Z[2]),V&2&&w(C,"width",Z[1])},i:F,o:F,d(Z){Z&&Y(t),e[13](null),y=!1,R(v)}}}function Kt(e,t,n){let l,o;Qe(()=>{o=l.getContext("2d"),o.imageSmoothingEnabled=!0,o.imageSmoothingQuality="high"});let i=1280,r=720,c=5,f=10,s="#F5DEB3",u=[i,r];async function a(){n(0,l.width=i,l),n(0,l.height=r,l),o.fillStyle=s,o.clearRect(0,0,i,r),o.fillRect(0,0,i,r);const C=await Lt(i/r),[L,m]=Ft(o,C,f,f,i-f*2,r-f*2,c);u=[L+f*2,m+f*2]}async function g(){const[C,L]=u,m=await createImageBitmap(l);n(0,l.width=C,l),n(0,l.height=L,l),o.drawImage(m,0,0);const y=l.toDataURL();let v=document.createElement("a");v.href=y,v.download="collage.png",v.click()}function d(){i=N(this.value),n(1,i)}function p(){r=N(this.value),n(2,r)}function I(){c=N(this.value),n(3,c)}function h(){f=N(this.value),n(4,f)}function W(){s=this.value,n(5,s)}function k(C){ce[C?"unshift":"push"](()=>{l=C,n(0,l)})}return[l,i,r,c,f,s,a,g,d,p,I,h,W,k]}class Xt extends J{constructor(t){super(),A(this,t,Kt,Vt,H,{})}}function Rt(e){let t,n,l,o,i,r,c,f,s,u,a,g,d,p,I;return o=new Gt({}),r=new kt({}),u=new gt({}),p=new Xt({}),{c(){t=_("main"),n=_("h1"),n.textContent="1. Choose images",l=j(),q(o.$$.fragment),i=j(),q(r.$$.fragment),c=j(),f=_("h1"),f.textContent="2. Manage images",s=j(),q(u.$$.fragment),a=j(),g=_("h1"),g.textContent="3. Generate Collage",d=j(),q(p.$$.fragment),w(n,"class","svelte-enb3qt"),w(f,"class","svelte-enb3qt"),w(g,"class","svelte-enb3qt"),w(t,"class","svelte-enb3qt")},m(h,W){S(h,t,W),b(t,n),b(t,l),M(o,t,null),b(t,i),M(r,t,null),b(t,c),b(t,f),b(t,s),M(u,t,null),b(t,a),b(t,g),b(t,d),M(p,t,null),I=!0},p:F,i(h){I||(P(o.$$.fragment,h),P(r.$$.fragment,h),P(u.$$.fragment,h),P(p.$$.fragment,h),I=!0)},o(h){T(o.$$.fragment,h),T(r.$$.fragment,h),T(u.$$.fragment,h),T(p.$$.fragment,h),I=!1},d(h){h&&Y(t),O(o),O(r),O(u),O(p)}}}class Bt extends J{constructor(t){super(),A(this,t,null,Rt,H,{})}}new Bt({target:document.body});
